<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="朝闻道 夕死可矣">
<meta property="og:type" content="website">
<meta property="og:title" content="WYY's Blog">
<meta property="og:url" content="http://wu-yuanyi.github.io/index.html">
<meta property="og:site_name" content="WYY's Blog">
<meta property="og:description" content="朝闻道 夕死可矣">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WYY's Blog">
<meta name="twitter:description" content="朝闻道 夕死可矣">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wu-yuanyi.github.io/"/>





  <title>WYY's Blog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WYY's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">JUST DO IT</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2018/12/18/DataAnalysis/评分卡建模/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/18/DataAnalysis/评分卡建模/" itemprop="url">评分卡建模</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-18T15:56:45+08:00">
                2018-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis/" itemprop="url" rel="index">
                    <span itemprop="name">Data Analysis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="样本抽取和权重设置"><a href="#样本抽取和权重设置" class="headerlink" title="样本抽取和权重设置"></a>样本抽取和权重设置</h2><h3 id="样本抽样"><a href="#样本抽样" class="headerlink" title="样本抽样"></a>样本抽样</h3><p>​    <strong>好</strong>、<strong>坏</strong>各抽5000，<strong>不确定</strong>不参与建模（使特征区分更明显）。5000是业界建模的经验和惯例，当样本数不足5000或在5000左右时，全部参与建模。</p>
<p>采用分层随机抽样的方法。在数据量很大的情况下不抽样而使用全量数据进行建模会导致：程序缓慢、overfit。</p>
<h3 id="权重修正"><a href="#权重修正" class="headerlink" title="权重修正"></a>权重修正</h3><p>​    <strong>好</strong>的权重 = (<strong>好</strong> + <strong>不确定</strong>) / <strong>好</strong>。使得建模样本中的<strong>好</strong>在样本数量上可以代表全部样本的<strong>好</strong>和<strong>不确定</strong>。</p>
<h3 id="样本划分"><a href="#样本划分" class="headerlink" title="样本划分"></a>样本划分</h3><p>​    一般将样本以7:3划分为训练集和验证集。训练集中至少应有500个样本，才能建立较为稳定的模型。如果模型在训练集和验证集中的表现基本一致，则说明模型比较稳健。如果建模抽样中的<strong>坏</strong>样本数量不足（总共才500个左右），则全部参与训练，使用BootStrap方法进行重复抽样得到验证样本，并在验证样本集上使用BootStrap验证法评估模型表现。</p>
<p><a href="https://www.jianshu.com/p/708dff71df3a" target="_blank" rel="external">Bootstrap, Bagging, Boosting</a></p>
<h2 id="变量预筛选"><a href="#变量预筛选" class="headerlink" title="变量预筛选"></a>变量预筛选</h2><p>​    通过变量预筛选，可以降低变量个数，集中精力于质量较好的变量。</p>
<ul>
<li>业务角度：需要和机构业务人员及数据人员沟通讨论，对于质量较差的变量，不宜进入模型。</li>
<li>数据角度：通过数据描述性统计分析，计算变量缺失率。当模型有足够的变量可供挑选时，对缺失率高于95%对变量直接不予考虑。当变量不足时，缺失率高达99%对变量也可以加入候选清单，虽然缺失率这么高的变量一般最后不会入模。</li>
<li>其他角度：例如金额类变量、功能型变量通常不入模，但是金额之间的比值是可以考虑的。</li>
</ul>
<h2 id="变量取值分箱"><a href="#变量取值分箱" class="headerlink" title="变量取值分箱"></a>变量取值分箱</h2><h3 id="细分箱与粗分箱"><a href="#细分箱与粗分箱" class="headerlink" title="细分箱与粗分箱"></a>细分箱与粗分箱</h3><p>​    在模型开发过程中，需要对变量进行分箱，对于候选模型变量，变量取值分箱的步骤如下：</p>
<ol>
<li>细分箱（fine bining）：对连续变量平均细分成足够多的分箱，获取变量细分箱的WOE报告。</li>
<li>粗分箱（coarse bining）：依据细分箱的WOE报告，结合业务上对变量的理解和分箱合并规则（WOE损失最小），对分箱进行手工合并，获取候选变量的粗分箱WOE报告。</li>
</ol>
<p>​    通过分箱得到所有候选变量的WOE报告，从而获得每个变量取值的最佳分栏、每个栏位对于的证据权重（WOE）和此变量的信息值（IV）。由于后续步骤需要WOE无缺失才能进行，因此变量原始取值有缺失时，必须保证缺失值也有对应的WOE。如果一些分箱中没有<strong>好</strong>或<strong>坏</strong>导致无法计算此分箱的WOE，则需对此分箱进行调整或与其他分箱合并，以保证每个分箱都有WOE。</p>
<h3 id="变量分箱的一般原则"><a href="#变量分箱的一般原则" class="headerlink" title="变量分箱的一般原则"></a>变量分箱的一般原则</h3><ul>
<li>各分箱中的样本量不应过少，过少则不具有统计显著性，且不稳定。一般建议不低于全部样本的5%。</li>
<li>为能计算WOE，各分箱中应同时出现<strong>好</strong>和<strong>坏</strong>。若不满足，应将此分箱与其他分箱合并以满足。</li>
<li>WOE趋势应与业务角度一致，通常为直线型或U型（一般仅年龄）。对于有序型和区间型，如果趋势不单调，则通过合并分箱进行调整。</li>
<li>对于特殊取值，如<em>其他</em>、<em>逾期次数为0</em>等应单列分箱。</li>
<li>分箱数一般为3-6个，数量过少则区分不显著，数量过多则导致不稳定。</li>
<li>其他业务考虑，如<em>再婚</em>、<em>复婚</em>可与<em>已婚</em>合并。</li>
</ul>
<h3 id="无法遵循一般原则的情况"><a href="#无法遵循一般原则的情况" class="headerlink" title="无法遵循一般原则的情况"></a>无法遵循一般原则的情况</h3><ul>
<li>字符型变量的客观取值无法更改，难以保证至少分箱中含有5%的变量或分为3-6个分箱。有些取值就是很不相同不适合与其它取值合并且比例极少。例如<strong>职务</strong>，其中一些选项取值的比例非常少，如<em>局级</em>、<em>部级</em>职务在人群中比例远低于5%。如果和其他级别合并则体现不出不同职务之间的差别，变量作用降低。所以在保证WOE值单调、符合业务经验的情况下，可以将这些高级职务依然独立，能让最后的评分更分散一些。</li>
<li>机构希望最好分数更细分一些的时候，在保证WOE值单调的情况下，分箱可以更细一些。</li>
</ul>
<h3 id="变量分箱的步骤"><a href="#变量分箱的步骤" class="headerlink" title="变量分箱的步骤"></a>变量分箱的步骤</h3><ol>
<li><p>细分箱：</p>
<ul>
<li>数值型变量：按变量取值顺序排列，均匀分成10组。在取值边界尽量考虑业务解释进行取整，因此每组样本数可能略有波动。</li>
<li>字符型变量：对所有的字符值进行分箱，每个值作为一个单独的细分箱。</li>
</ul>
</li>
<li><p>对每个细分箱统计<strong>好账户</strong>和<strong>坏账户</strong>数，计算每个分箱的WOE值。计算公式如下：</p>
<p>$$ WOE(j) = \ln(\cfrac{f_G(j)}{f_B(j)})$$</p>
<p>$$f_G(j)$$：$$g_i/G$$ 分箱j中<strong>好</strong>样本数占总样本中<strong>好</strong>样本数的比例</p>
<p>$$f_B(j)$$：$$b_i/B$$ 分箱j中<strong>坏</strong>样本数占总样本中<strong>坏</strong>样本数的比例</p>
<p>​    说明：该公式表示第j类中正常与违约的比率与整个样本中正常与违约的比率的比值的对数。因此，该公式主要衡量第j类对正常与违约比率的影响程度。</p>
</li>
<li><p>粗分箱：将WOE值相近的细分箱且有业务意义的细分箱合并为粗分箱。对于数值型变量，通常将相邻的细分箱合并；对于字符型变量，通常将同类细分箱合并。对于特殊值和缺失值等，一般会保留一个各自单独的粗分箱；结合实际情况，考虑特殊值与缺失值的产生原因与业务含义，分析与其他分箱合并后是否更合理。</p>
</li>
<li><p>分箱原则：</p>
<ol>
<li>WOE值是否单调（年龄除外）</li>
<li>分箱数量一般控制在4-5个以内，太多容易不稳定</li>
<li>每一个分箱的占比应当平均分配，不宜出现某个变量取值的占比过高或过低</li>
<li>容易被客户或客户经理操纵的变量（如贷款期限，这种变量虽然可以衡量客户的还款能力，但也容易受客户经理推荐激励的影响），变量足够时不建议入模。</li>
</ol>
<p>​    变量的分箱是模型开发最关键的步骤之一，粗分箱后的各个分箱的WOE值的增减趋势必须满足合理的业务解释，并能保持比较稳定的分布。粗分箱产生的WOE值将替代原始数据值进入接下来的模型优化步骤。粗分箱结束后将生成二维变量报告，以确保每个使用的变量既可以表现出清晰的分辨力，又符合业务逻辑。未能符合任何选择条件的变量都将被剔除，以有利于其他候选变量的进入。</p>
</li>
</ol>
<h3 id="IV"><a href="#IV" class="headerlink" title="IV"></a>IV</h3><p>​    信息值（Information Value）代表了同整个群体相比，某一特征变量在所有区间中的好和坏之间的比例是否存在差异。在一个互联网信贷金融机构风险管理比较成熟，数据收集比较完善，数据总体质量较为可信的情况下，一个变量的信息值一般在0.05以上，则认为这个变量对因变量有一定的区分能力。如果数据覆盖面与数据质量不够完善，可用的数据信息比较少，则对变量的信息值的阈值会有不同的考虑。</p>
<p>$$ IV = \Sigma \lbrace (\cfrac{g_i}{G} - \cfrac{b_i}{B}) \ast \ln(\cfrac{g_i}{G}/\cfrac{b_i}{B})  \rbrace​$$</p>
<p>$$g_i$$：变量第i 个分箱栏位中的好样本数</p>
<p>$$G$$：样本中好样本总数</p>
<p>$$b_i$$：变量第i 个分箱栏位中坏样本数</p>
<p>$$B$$：样本中坏样本总数</p>
<h2 id="变量再筛选"><a href="#变量再筛选" class="headerlink" title="变量再筛选"></a>变量再筛选</h2><h3 id="WOE值与IV"><a href="#WOE值与IV" class="headerlink" title="WOE值与IV"></a>WOE值与IV</h3><p>变量充足、好用的情况下，依据IV和WOE值趋势的一般剔除原则：</p>
<ul>
<li>IV&lt;0.01：原则上IV越大越好，但是不同互联网信贷金融机构数据情况不同，可选的变量也可能不同。所以没有IV值低于多少就不能用的严格标准，否则某些情况下IV过低就无法完成建模。一般而言，IV值不低于0.01。同一家信贷金融机构的不同产品的数据情况和好坏情况也可能不一致，所以不同评分卡模型也可以选择不同的阈值。若可成功入模的变量过少，可不依此条件剔除变量。</li>
<li>WOE值趋势与业务理解不一致的变量</li>
<li>集中度过高，如某一取值分箱的占比超过98%</li>
</ul>
<h3 id="逐步判别（Stepdisc）"><a href="#逐步判别（Stepdisc）" class="headerlink" title="逐步判别（Stepdisc）"></a>逐步判别（Stepdisc）</h3><p>​    在完成上述简单的变量筛选后，变量选择过程进入下一步骤：变量降维。从模型中没有变量开始，逐个引入变量，每增加一个变量后都要检查，用逐步判别的方法去除那些无助于模型预测能力的变量。当模型中所有变量符合标准而无其他变量符合进入的标准时，选择程序结束。一般在进行逐步判别程序（StepDisc Procedure）时，设定添加变量的置信水平（SLE）=0.15，去除变量的置信水平（SLS）=0.15。置信水平参数值越小，被选中的变量个数就会越少。</p>
<p>​    逐步判别程序的目的是从变量池内所有可能的变量中，初步确定最具预测能力的特征变量组合。在这一过程中，对每个可能进入模型的特征变量反复进行测试，以观察其辨别好坏记录的有效性。每次对一个新的变量反复进行测试，结果要么是此变量已无法再有区分的贡献性，要么是成为已选择的模型变量的一部分。该过程是基于对当前的特征变量充当因变量和模型中的其他变量当作随机变量进行协方差分析进行的。一旦不再有新变量进入模型或从模型中去除变量时，选择过程结束。保留下来的头部变量是最可能进入最终模型的候选特征变量。</p>
<p>​    逐步判别程序所选变量为模型最终变量的起点。通常情况下，会依据行业经验，将部分没有通过逐步判别筛选，但业务含义明显的字段也一并作为最终模型变量选择的起点。</p>
<p>​    以上所有的原则和步骤，除了WOE值趋势必须和业务理解、行业习惯一致是必须遵守的，其他是一般原则可以突破。在按照以上原则挑选的基础上，如果得到的变量不符合建模条件，有可能会返回<strong>变量再挑选</strong>这一步骤，再人工挑选一些原本未被选中的变量。例如：在经过前文各种筛选后可选变量很少的情况下，如不足50个变量，可以不进行逐步判别程序，直接跳往下一步逻辑回归进行回归检验；<em>性别</em>是常用的入模变量，即使其IV值小于0.02，但如果满足一切建模要求，并可以让评分更分散，也可以考虑入模。</p>
<h2 id="WOE值转换说明"><a href="#WOE值转换说明" class="headerlink" title="WOE值转换说明"></a>WOE值转换说明</h2><p>​    在逻辑回归建模时，使用的是变量值对应的WOE值，而不是变量的原始取值。不单单是被选中的变量，所有做过分箱的变量都会如此进行处理。以防选中的变量不满足建模条件时，需要人工调用其他最初始未被选中的变量时，需要重新转换WOE值。</p>
<p>​    例如，性别的原始取值是<strong>男</strong>、<strong>女</strong>，在WOE报告中对应的分别是<strong>-0.0334</strong>和<strong>0.1838</strong>。完成转换后，<strong>男</strong>、<strong>女</strong>的取值就会被<strong>-0.0334</strong>和<strong>0.1838</strong>替代。</p>
<h2 id="逻辑回归建模"><a href="#逻辑回归建模" class="headerlink" title="逻辑回归建模"></a>逻辑回归建模</h2><p>​    分为多重共线性检验和逻辑回归两个步骤，并不是所有通过初筛的变量都能通过这两步都校验，其最终结果通过最大似然估计值分析和方差膨胀分析两张参数结果表展现出来。从第一张表可以看到逻辑回归常数项及各入模字段的系数的估计值，从第二张表可以看到方差膨胀系数。</p>
<p>剔除变量的原则如下：</p>
<ul>
<li>回归系数为正的变量。随着变量的各个分箱的WOE值上升，其坏账率越低，这样才能符合业务逻辑，因此需要保证所有入模变量的回归系数均为负数。</li>
<li>P值太高的变量。P值一般不能高于0.10，当可入模变量过少时，可以放宽到0.15</li>
<li>相关性太高造成高VIF（方差膨胀系数）的变量。VIF一般不能大于10，最好不要超过4。对于多个高度相关的变量，保留业务上最有意义、最稳定、最可信的一个。</li>
<li>业务专家认为不适合入模的。如贷款用途，因为分箱可能不稳定，没有特别的规则，最终不考虑入模。</li>
<li>其他情况。考虑到入模变量维度的多样性，或者变量的直观业务意义，有时会将几个过于类似的变量替换掉1-2个，换上类似但是维度和角度不同的变量。</li>
</ul>
<h2 id="评分标准化说明"><a href="#评分标准化说明" class="headerlink" title="评分标准化说明"></a>评分标准化说明</h2><p>​    逻辑回归模型得到的是概率（违约概率估计），而最终实际实施时使用的是简单直观的评分。所以需要依据评分卡原理，将概率值标准化为分数值，在这个过程中还可以得到评分值表（即每个变量的各种取值得到多少分）。每个坏账率对应一个好坏比（$$odds=(1-p)/p$$，p为坏样本所占百分比）。</p>
<p>​    评分标准化需要三个参数：</p>
<ul>
<li>基准评分（points0）</li>
<li>基准好坏比(odds0)：在基准评分下，人群所对应的好坏比</li>
<li>好坏比加倍分值（PDO，Points to Double the Odds）：评分提高多少才能使其所对应的好坏比成为原来的两倍</li>
</ul>
<p>​    通过与基准评分作比较，可直观的得到标准化后评分所对应的odds。如校准后评分比基准分高PDO分，则其对应的odds为基准odds的两倍。</p>
<p>​    评分卡的分值刻度通过将分值表示为比率对数的线性表达式$$score = A + B*ln(odds)​$$，其中，$$A​$$（称为补偿）和$$B​$$（称为刻度）是常数。好坏比率$$odds=(1-p) / p​$$为一个客户正常的估计概率与违约的估计概率的比率，$$ln(odds)​$$为逻辑回归的因变量，即$$ln(odds)=w^Tx + b​$$。</p>
<p>$$points0 = A + B*ln(odds0)$$</p>
<p>$$points0 + PDO = A + B * ln(2odds0)​$$</p>
<p>$$B = PDO / ln(2)$$</p>
<p>$$A = points0 - B * ln(odds0)​$$</p>
<p>$$score = A + B * ln(odds) = A + B(w^Tx + b) = (A + Bb) + Bw_1x_1 + Bw_2x_2 +  … + Bw_mx_m$$ </p>
<p>其中，$$points0$$是基准评分，$$odds0$$是基准好坏比，$$PDO$$是好坏比加翻倍的分值，$$x_1 … x_m$$为逻辑回归的变量系数，$$w_i$$为最终进入模型的自变量且已经转为WOE值，$$b$$为逻辑回归的截距，$$Bw_ix_i$$为变量$$x_i$$对应的评分，$$(A - Bb)$$为基础分（也可将基础分值平均分配给各个变量）。</p>
<h2 id="模型表现评估说明"><a href="#模型表现评估说明" class="headerlink" title="模型表现评估说明"></a>模型表现评估说明</h2><h3 id="模型表现评估指标"><a href="#模型表现评估指标" class="headerlink" title="模型表现评估指标"></a>模型表现评估指标</h3><p>​    国内一般重点看KS（Kolmogorov-Smirnov）和Gini系数这两个统计值。这两个指标在合理范围内越高，表明模型的区分能力越强。同时，模型还可以通过Divergence（离散度）、AUC（Area under Curve），ROC（Receiver Operating Characteristic）的值和图形进行评估。以上评估值都是越高越好，但是要在合理的范围内。如果过高，可能是因为过拟合或者特殊数据造成的。</p>
<p>​    由于KS的值，和模型的类型、数据质量、客户群体特征都有很大关系，所以能接受的合理范围也有所不同。其他指标一般无明确划分点。</p>
<table>
<thead>
<tr>
<th>K-S值</th>
<th>申请（好坏区分能力）</th>
<th>行为（好坏区分能力）</th>
</tr>
</thead>
<tbody>
<tr>
<td>20以下</td>
<td><strong>不建议采用</strong> 因为表现期不足，模型验证或上线初期可能会在这个范围。</td>
<td><strong>不建议采用</strong> 因为表现期不足，模型验证或上线初期可能会在这个范围。</td>
</tr>
<tr>
<td>20-29</td>
<td><strong>较好</strong> 在没有人行报告或其他强外部数据的情况下，如果申请数据质量不理想，贷款和信用卡模型都容易落在此区间。</td>
<td><strong>较弱</strong> 在还款和逾期历史数据都较弱（先息后本或一次性还款）的情况下，可用变量很少，贷款和信用卡模型都容易落在此区间。</td>
</tr>
<tr>
<td>30-49</td>
<td><strong>良好</strong> 在没有人行报告或其他强外部数据的情况下，如果申请数据质量很好，贷款和信用卡模型都容易落在此区间。</td>
<td><strong>较好</strong> 在还款和逾期历史数据都较弱（逾期账户极少）的情况下，可用变量不强，贷款和信用卡模型都容易落在此区间。</td>
</tr>
<tr>
<td>40-55</td>
<td><strong>很强</strong> 有人行征信等外部数据切申请数据质量很好，模型一般落在此区间。</td>
<td><strong>良好</strong> 大部分贷款和信用卡模型都容易落在此区间。</td>
</tr>
<tr>
<td>56-75</td>
<td><strong>非常强</strong> 很少见，能力高但疑似过拟合，可能放了过多征信报告中的逾期变量。</td>
<td><strong>很强</strong> 很少见，能力高但疑似过拟合，可能放了过多征信报告中的逾期变量。</td>
</tr>
<tr>
<td>75以上</td>
<td>极少见 能力高但疑似过拟合。</td>
<td><strong>非常强</strong> 很少见，能力高但疑似过拟合。</td>
</tr>
</tbody>
</table>
<h3 id="模型表现评估图表"><a href="#模型表现评估图表" class="headerlink" title="模型表现评估图表"></a>模型表现评估图表</h3><p>​    模型的评分排序表（Score Chart）就是将建模开发样本的评分从低到高排序，显示每个评分上的好坏个数，好坏比例以及坏账率等。详细的排序表不对评分进行组合；综合的排序表对评分进行组合，按照评分从低分区间到高分区间将建模开发样本账户等分为5-10组（每组账户比例大致相等）之后，区间坏账率也是从低分区间到高分区间单调下降，以说明模型等排序性强弱。</p>
<h2 id="模型的验证说明"><a href="#模型的验证说明" class="headerlink" title="模型的验证说明"></a>模型的验证说明</h2><p>根据验证样本的时间段不同，模型验证及其样本可以分为以下三类：</p>
<ul>
<li>开发期预留样本验证（时间内样本验证，Hold-Out Testing）。对Testing样本的验证要求一般是需要其入模变量趋势稳定，模型的极大评估指标稳定。当无法预留此样本时，可以采取Bootstrap法来造出样本进行验证。</li>
<li>时间外样本验证（Out-Of-Time，一般是比开发样本更晚更新的数据）。在表现期不足的情况下，不要求OOT样本上模型的几大评估指标稳定或者更好，而多是检查模型的排序性和稳定性。一般通过评分排序表、入模变量的PSI值和评分排序的PSI值来评估，样本中好坏不确定不需要抽样。如果有足够多表现充足的时间外验证样本，在坏样本比较多的情况下，可以希望其评分后的模型评估指标较好、稳定或更好。</li>
<li>上线后跟踪验证（Go-Online，上线后获取的数据）。一般在模型一期开发阶段没有这些数据，所以不会进行。上线后跟踪新账户一般表现期都不够，一开始不能要求模型的几大评估指标稳定或者更好，而多是检查模型的排序性和稳定性，一般通过入模变量的PSI值和评分排序的PSI值来实现。应用上线后，更看重的是评分保持排序性，积累到表现期足够后可以希望其评分后的模型评估指标较好、稳定或更好。</li>
</ul>
<p>模型具体的验证方法和指标分为以下几类：</p>
<ul>
<li><p>标准验证：KS，Gini系数、ROC、AUC和评分排序性等，需要样本的表现期充足。</p>
</li>
<li><p>BootStrap：从建模开发样本中有放回的随机抽样出1000-5000个样本（无需按好坏分层抽）组成一个数据集，计算其模型评分值，依据评分和好坏计算模型评估指标，一般主要看KS。可以如此反复抽10-100次，最后得到一个平均值，和模型开发样本的评估指标进行比较，若接近则验证通过。</p>
</li>
<li><p>稳定性验证：看每个入模变量的PSI、整体评分的PSI、评分的排序性。理想的PSI小于0.1，政策、客户和数据的变化最容易导致PSI变大，其标准见下表：</p>
<p>| PSI      | 结果               |<br>| ——– | —————— |<br>| <0.1 |="" 正常="" 0.1-0.25="" 需要关注，找出原因="">0.25    | 重大变化，找出原因 |</0.1></p>
</li>
</ul>
<h2 id="模型评估参数"><a href="#模型评估参数" class="headerlink" title="模型评估参数"></a>模型评估参数</h2><h3 id="K-S值"><a href="#K-S值" class="headerlink" title="K-S值"></a>K-S值</h3><p>​    K-S值用来衡量模型区分好坏的能力，即模型的预测能力。K-S的值由多种因素决定，如：数据源和数据信息的可获取度、数据的质量、产品类型、群体的稳定性。该指标衡量的是<strong>好</strong>和<strong>坏</strong>的累积分布之间最大的差距。好账户与坏账户分布之间的差异越大，K-S指标越高，模型的区分能力越强。但K-S值不是越高越好，太高容易出现过拟合或是由特殊数据造成。</p>
<h3 id="Gini系数"><a href="#Gini系数" class="headerlink" title="Gini系数"></a>Gini系数</h3><p>​    Gini系数用来衡量模型的区分能力，Gini系数越高，表明模型的排序能力越强。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2018/09/25/Database/HiveQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/25/Database/HiveQL/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-25T15:57:20+08:00">
                2018-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Database/" itemprop="url" rel="index">
                    <span itemprop="name">Database</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Data-Types"><a href="#Data-Types" class="headerlink" title="Data Types"></a>Data Types</h1><h2 id="Column-Types"><a href="#Column-Types" class="headerlink" title="Column Types"></a>Column Types</h2><h3 id="Timestamps"><a href="#Timestamps" class="headerlink" title="Timestamps"></a>Timestamps</h3><p>Timestamps are interpreted to be timezoneless and stored as an offset from the UNIX epoch.</p>
<p>Supported conversions:</p>
<ul>
<li>Integer numeric types: Interpreted as UNIX timestamp in seconds</li>
<li>Floating point numeric types: Interpreted as UNIX timestamp in seconds with decimal precision</li>
<li>Strings: JDBC compliant java.sql.Timestamp format <code>YYYY-MM-DD HH:MM:SS.fffffffff</code> (9 decimal place precision)</li>
</ul>
<h3 id="Dates"><a href="#Dates" class="headerlink" title="Dates"></a>Dates</h3><p>Date values describe a particular year/month/day, in the form <code>YYYY-­MM-­DD</code>. The range of values supported for the Date type is 0000-­01-­01 to 9999-­12-­31.</p>
<ul>
<li>cast(timestamp as date): The year/month/day of the timestamp is determined, based on the local timezone, and returned as a date value.</li>
<li>cast(string as date): If the string is in the form <code>YYYY-MM-DD</code>, then a date value corresponding to that year/month/day is returned. If the string value does not match this formate, then NULL is returned.</li>
</ul>
<h3 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h3><p>The first part in the deserialized union is the <em>tag</em> which lets us know which part of the union is being used. In this example <code>0</code> means the first data_type from the definition which is an <code>int</code> and so on.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE union_test(foo UNIONTYPE&lt;int, double, array&lt;string&gt;, struct&lt;a:int,b:string&gt;&gt;);</div><div class="line">SELECT foo FROM union_test;</div><div class="line"></div><div class="line">&#123;0:1&#125;</div><div class="line">&#123;1:2.0&#125;</div><div class="line">&#123;2:["three","four"]&#125;</div><div class="line">&#123;3:&#123;"a":5,"b":"five"&#125;&#125;</div><div class="line">&#123;2:["six","seven"]&#125;</div><div class="line">&#123;3:&#123;"a":8,"b":"eight"&#125;&#125;</div><div class="line">&#123;0:9&#125;</div><div class="line">&#123;1:10.0&#125;</div></pre></td></tr></table></figure>
<p>To create a union you have to provide this tag to the <code>create_union</code> UDF:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SELECT create_union(0, key), create_union(if(key&lt;100, 0, 1), 2.0, value), create_union(1, "a", struct(2, "b")) FROM src LIMIT 2;</div><div class="line"></div><div class="line">&#123;0:"238"&#125;	&#123;1:"val_238"&#125;	&#123;1:&#123;"col1":2,"col2":"b"&#125;&#125;</div><div class="line">&#123;0:"86"&#125;	&#123;0:2.0&#125;	&#123;1:&#123;"col1":2,"col2":"b"&#125;&#125;</div></pre></td></tr></table></figure>
<h2 id="Literals"><a href="#Literals" class="headerlink" title="Literals"></a>Literals</h2><h3 id="Floating-Point-Types"><a href="#Floating-Point-Types" class="headerlink" title="Floating Point Types"></a>Floating Point Types</h3><p>Decimal literals provide precise values and greater range for floating point numbers than the DOUBLE type. Decimal types are needed for use cases in which the (very close) approximation of a DOUBLE is insufficient, such as financial applications, equality and inequality checks, and rounding operations.</p>
<h1 id="Date-Definition-Statements"><a href="#Date-Definition-Statements" class="headerlink" title="Date Definition Statements"></a>Date Definition Statements</h1><h2 id="Create-Drop-Truncate-Table"><a href="#Create-Drop-Truncate-Table" class="headerlink" title="Create/Drop/Truncate Table"></a>Create/Drop/Truncate Table</h2><h3 id="Managed-and-External-Tables"><a href="#Managed-and-External-Tables" class="headerlink" title="Managed and External Tables"></a>Managed and External Tables</h3><ul>
<li><p>Use managed tables when Hive should manage the lifecycle of the table, or when generating temporary tables.</p>
</li>
<li><p>External table files can be accessed and managed by processes outside of Hive.</p>
</li>
</ul>
<p>If a managed table or partition is dropped, the data and metadata associated with that table or partition are deleted. If the PURGE option is not specified, the data is moved to a trash folder for a defined duration.</p>
<h3 id="CTSAS"><a href="#CTSAS" class="headerlink" title="CTSAS"></a>CTSAS</h3><p>CTAS(create table as select) has these restrictions:</p>
<ul>
<li>The target table cannot be a partitioned table.</li>
<li>The target table cannot be an external table.</li>
<li>The target table cannot be a list bucketing table.</li>
</ul>
<p>##Macro and Function</p>
<h3 id="Create-Drop-Temporary-Macro"><a href="#Create-Drop-Temporary-Macro" class="headerlink" title="Create/Drop Temporary Macro"></a>Create/Drop Temporary Macro</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> MACRO macro_name([col_name col_type, ...]) expression;</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> MACRO fixed_number() <span class="number">42</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> MACRO string_len_plus_two (x <span class="keyword">string</span>) <span class="keyword">length</span>(x) + <span class="number">2</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> MACRO simple_add (x <span class="built_in">int</span>, y <span class="built_in">int</span>) x + y;</div><div class="line"></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TEMPORARY</span> MACRO [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] macro_name;</div></pre></td></tr></table></figure>
<h3 id="Temporary-Functions"><a href="#Temporary-Functions" class="headerlink" title="Temporary Functions"></a>Temporary Functions</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">FUNCTION</span> function_name <span class="keyword">AS</span> class_name;</div><div class="line"></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TEMPORARY</span> <span class="keyword">FUNCTION</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] function_name;</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> [db_name.]function_name <span class="keyword">AS</span> class_name [<span class="keyword">USING</span> JAR|<span class="keyword">FILE</span>|<span class="keyword">ARCHIVE</span> <span class="string">'file_uri'</span> [, JAR|<span class="keyword">FILE</span>|<span class="keyword">ARCHIVE</span> <span class="string">'file_uri'</span>] ];</div></pre></td></tr></table></figure>
<h2 id="Data-Retrieval-Queries"><a href="#Data-Retrieval-Queries" class="headerlink" title="Data Retrieval: Queries"></a>Data Retrieval: Queries</h2><h3 id="HAVING-Clause"><a href="#HAVING-Clause" class="headerlink" title="HAVING Clause"></a>HAVING Clause</h3><p>The <figure class="highlight plain"><figcaption><span>clause was added to SQL because the ```WHERE``` keyword could not be used with aggregate functions.</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">```WHERE``` works before return result, ```HAVING``` filter the result returned by query.</div><div class="line"></div><div class="line">```sql</div><div class="line">select col1 from t1 group by col1 having sum(col2) &gt; 10;</div><div class="line">select col1 from (select col1, sum(col2) as col2sum from t1 group by col1) t2 where t2.col2sum &gt; 10;</div></pre></td></tr></table></figure></p>
<h3 id="LIMIT-Clause"><a href="#LIMIT-Clause" class="headerlink" title="LIMIT Clause"></a>LIMIT Clause</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers <span class="keyword">limit</span> <span class="number">5</span>;</div><div class="line"><span class="comment">--The previous query returns 5 arbitrary customers</span></div><div class="line"></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers <span class="keyword">order</span> <span class="keyword">by</span> create_date <span class="keyword">limit</span> <span class="number">5</span>;</div><div class="line"><span class="comment">--The previous query returns the first 5 customers to be created</span></div><div class="line"></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers <span class="keyword">order</span> <span class="keyword">by</span> create_date <span class="keyword">limit</span> <span class="number">2</span>,<span class="number">5</span>;</div><div class="line"><span class="comment">--The previous query returns the  3rd to the 7th customers to be created</span></div></pre></td></tr></table></figure>
<h3 id="REGEX-Column-Specification"><a href="#REGEX-Column-Specification" class="headerlink" title="REGEX Column Specification"></a>REGEX Column Specification</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">set</span> hive.support.quoted.identifiers=<span class="keyword">none</span>;</div><div class="line"><span class="comment">--The following query selects all columns except ds and hr.</span></div><div class="line"><span class="keyword">SELECT</span> <span class="string">`(ds|hr)?+.+`</span> <span class="keyword">FROM</span> sales;</div></pre></td></tr></table></figure>
<h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><p>Multiple aggregations can be done at the same time, however, no two aggregations can have different DISTINCT columns. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> users.gender, <span class="keyword">count</span>(<span class="keyword">distinct</span> users.userid), <span class="keyword">count</span>(*), <span class="keyword">sum</span>(<span class="keyword">distinct</span> users.userid) <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">group</span> <span class="keyword">by</span> users.gender;</div></pre></td></tr></table></figure>
<p>When using group by clause, the select statement can only include columns included in the group by clause. Of course, you can have as many aggregation functions in the select statement as well.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> a, <span class="keyword">sum</span>(b) <span class="keyword">from</span> t1 <span class="keyword">group</span> <span class="keyword">by</span> a;</div></pre></td></tr></table></figure>
<p><em>hive.map.aggr</em> controls how we do aggregations. The default is false. If it is set to true, Hive will do the first-level aggregation directly in the map task. This usually provides better efficiency, but may require more memory to run successfully.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">set</span> hive.map.aggr=<span class="literal">true</span>;</div><div class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> table2;</div></pre></td></tr></table></figure>
<h3 id="Order-Sort-Distribute-Cluster-By"><a href="#Order-Sort-Distribute-Cluster-By" class="headerlink" title="Order/Sort/Distribute/Cluster By"></a>Order/Sort/Distribute/Cluster By</h3><p>There are some limitations in the <figure class="highlight plain"><figcaption><span>by``` clause. In the strict mode (i.e., ``` set hive.mapred.mode=strict```), the order by clause has to be followed by a ```limit``` clause. The reason is that in order to impose total order of all results, there has to be one reducer to sort the final output. If the number of rows in the output is too large, the single reducer could take a very long time to finish.</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">```sql</div><div class="line">order by colName (asc|desc) (nulls first|last) (, (asc|desc) (nulls first|last))</div></pre></td></tr></table></figure></p>
<p>The difference between <figure class="highlight plain"><figcaption><span>by``` and ```sort by``` is that the former guarantees total order in the output while the latter only guarantees ordering of the rows within a reducer. If there are more than one reducer, ```sort by``` may give partially ordered final results. The difference between ```sort by``` alone of a single column and ```cluster by``` is that ```cluster by``` partitions by the field and ```sort by``` if there are multiple reducers partitions randomly in order to distribute data (and load) uniformly across the reducers.</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">```sql</div><div class="line">select key, value from src sort by key asc, value desc;</div></pre></td></tr></table></figure></p>
<p><code>cluster By</code> is a short-cut for both <code>distribute By</code> and <code>sort By</code>.</p>
<h3 id="Operators-and-UDFS"><a href="#Operators-and-UDFS" class="headerlink" title="Operators and UDFS"></a>Operators and UDFS</h3><ul>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-RelationalOperators" target="_blank" rel="external">Relational Operators</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-ArithmeticOperators" target="_blank" rel="external">Arithmetic Operators</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-LogicalOperators" target="_blank" rel="external">Logical Operators</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-StringOperators" target="_blank" rel="external">String Operators</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions" target="_blank" rel="external">Mathematical Functions</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-CollectionFunctions" target="_blank" rel="external">Collection Functions</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-TypeConversionFunctions" target="_blank" rel="external">Type Conversion Functions</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-DateFunctions" target="_blank" rel="external">Date Functions</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-ConditionalFunctions" target="_blank" rel="external">Conditional Functions</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-StringFunctions" target="_blank" rel="external">String Functions</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-DataMaskingFunctions" target="_blank" rel="external">Data Masking Functions</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2018/06/19/DataAnalysis/推荐系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/19/DataAnalysis/推荐系统/" itemprop="url">推荐系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-19T11:41:20+08:00">
                2018-06-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis/" itemprop="url" rel="index">
                    <span itemprop="name">Data Analysis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="推荐引擎简介"><a href="#推荐引擎简介" class="headerlink" title="推荐引擎简介"></a>推荐引擎简介</h2><p><img src="/2018/06/19/DataAnalysis/推荐系统/recommendation_engines_chematic.png" alt="recommendation_engines_chematic"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2018/04/17/DataAnalysis/风控建模/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/17/DataAnalysis/风控建模/" itemprop="url">风控建模</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-17T16:32:16+08:00">
                2018-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis/" itemprop="url" rel="index">
                    <span itemprop="name">Data Analysis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="模型评估指标"><a href="#模型评估指标" class="headerlink" title="模型评估指标"></a>模型评估指标</h2><h3 id="混淆矩阵-Confusion-matrix"><a href="#混淆矩阵-Confusion-matrix" class="headerlink" title="混淆矩阵 Confusion matrix"></a>混淆矩阵 Confusion matrix</h3><table>
<thead>
<tr>
<th></th>
<th>预测1</th>
<th>预测0</th>
<th>合计</th>
</tr>
</thead>
<tbody>
<tr>
<td>实际1</td>
<td>TP(True Positive)</td>
<td>FN(False Negative)</td>
<td>Actual Positive</td>
</tr>
<tr>
<td>实际0</td>
<td>FP(False Positive)</td>
<td>TN(True Negative)</td>
<td>Actual Negative</td>
</tr>
<tr>
<td>合计</td>
<td>Predicted Positive</td>
<td>Predicted Negative</td>
<td>All</td>
</tr>
</tbody>
</table>
<ul>
<li>Recall(召回率), Sensitivity(敏感性): TP / (TP + FN)</li>
<li>Precision(精确率): TP / (TP + FP)</li>
<li>Specificity(特异性): TN / (TN + FP)</li>
<li>Accuracy(准确率): (TP + TN) / (TP + FP + FN + TN)</li>
<li>F值：F-measure = 2 <em> (Recall </em> Precision) / (Recall + Precision)<ul>
<li>加权调和平均数，假设Precision和Recall同样重要</li>
</ul>
</li>
</ul>
<h3 id="ROC和AUC"><a href="#ROC和AUC" class="headerlink" title="ROC和AUC"></a>ROC和AUC</h3><p>ROC（Receiver Operating Characteristic）曲线和AUC（Area Under Curve）常被用来评价一个二值分类器（binary classifier）的优劣。</p>
<h4 id="ROC"><a href="#ROC" class="headerlink" title="ROC"></a>ROC</h4><p>ROC曲线的横坐标为false positive rate（FPR），纵坐标为true positive rate（TPR）。</p>
<p>FPR = 1- Specificity = FP / N = FP / (TN + FP)</p>
<p>TPR = Recall = Sensitivity = TP / P = TP / (TP + FN)</p>
<p><img src="/2018/04/17/DataAnalysis/风控建模/roc_curves.png" alt="roc_curve"></p>
<ul>
<li>(0,1)：FPR=0，TPR=1，即FP和FN都为0，所有分类都正确。</li>
<li>(1,0)：FPR=1，TPR=0，即FP和FN都为1，所有分类都错误。</li>
<li>(0,0)：FPR=0，TPR=0，即FP为0，FN为1，所有分类预测为负样本。</li>
<li>(1,1)：FPR=1，TPR=1，即FP为1，FN为0，所有分类预测为正样本。</li>
<li>y=x线上：采用随机分类的分类器。</li>
<li>ROC曲线越接近左上角，该分类器性能越好。</li>
</ul>
<p>ROC曲线的优点：当测试集中的正负样本的分布变化的时候，ROC曲线能够保持不变。在实际的数据集中经常会出现类不平衡（class imbalance）现象，即负样本比正样本多很多（或者相反），而且测试数据中的正负样本的分布也可能随着时间变化。</p>
<h4 id="AUC"><a href="#AUC" class="headerlink" title="AUC"></a>AUC</h4><p>AUC（Area Under Curve）被定义为ROC曲线下的面积。由于ROC曲线一般都处于y=x这条直线的上方，所以AUC的取值范围在0.5和1之间。</p>
<blockquote>
<p>The AUC value is equivalent to the probability that a randomly chosen positive example is ranked higher than a randomly chosen negative example.</p>
</blockquote>
<p>AUC值越大，当前分类算法越可能将正样本排在负样本之前，即能更好的分类。</p>
<h3 id="Lift"><a href="#Lift" class="headerlink" title="Lift"></a>Lift</h3><p>Lift = [TP/(TP+FP)] / [(TP+FN)/(TP + FP + TN + FN)]</p>
<p>用于衡量与不利用模型相比，模型预测能力的提升度。Lift越大，模型效果越好。</p>
<p>在不使用模型时（baseline model），需要在整个样本中挑选，挑选的准确率是(TP+FN)/(TP + FP + TN + FN)。</p>
<p>在使用模型时，，只在预测为positive的样例中挑选，挑选的准确率是TP/(TP+FP)。<img src="/2018/04/17/DataAnalysis/风控建模/lift.png" alt="lift"></p>
<p>当阈值越大，越少的观测值会归为正例，但这部分越具有正例特征（以银行向客户推荐信用卡的例子来看，这一部分人群对推荐的反应最为活跃），所以在这个设置下，对应的lift值最大。当阈值越小，越多的观测值会归为正例，这时分类的效果就跟baseline model差不多了，相对应的lift值就接近于1。</p>
<h3 id="Gain"><a href="#Gain" class="headerlink" title="Gain"></a>Gain</h3><p>增益图与提升图的区别在于纵坐标。它的纵坐标是TP/(TP+FP)。</p>
<p>增益图是描述整体精准率的指标。按照模型预测出的概率从高到低排列，将每一个百分位数内的精准率指标标注在图形区域内，就形成了非累积的增益图。如果对每一个百分位及其之前的精准率求和，并将值标注在图形区域内，则形成累积的增益图。</p>
<p><img src="/2018/04/17/DataAnalysis/风控建模/gain.png" alt="201800426gain"></p>
<h3 id="K-S"><a href="#K-S" class="headerlink" title="K-S"></a>K-S</h3><p>正样本洛伦兹曲线记为f(x)，负样本洛伦兹曲线记为g(x)，K-S曲线实际上是f(x)与g(x)的差值曲线。K-S曲线的最高点（最大值）定义为KS值，KS值越大，模型分值的区分度越好，KS值为0代表是最没有区分度的随机模型。准确的来说，K-S是用来度量阳性与阴性分类区分程度的。</p>
<p>K-S曲线的纵坐标是TPR与FPR。</p>
<p><img src="/2018/04/17/DataAnalysis/风控建模/k-s.png" alt="20180426k-s"></p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="http://alexkong.net/2013/06/introduction-to-auc-and-roc/" target="_blank" rel="external">ROC和AUC介绍以及如何计算AUC</a></p>
<p><a href="https://www.jianshu.com/p/6ffa3df3ec86" target="_blank" rel="external">如何评估一个机器学习模型</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2018/03/20/Loan/人行报告(详版)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/20/Loan/人行报告(详版)/" itemprop="url">人行报告专业版</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-20T11:05:28+08:00">
                2018-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Loan/" itemprop="url" rel="index">
                    <span itemprop="name">Loan</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="样本"><a href="#样本" class="headerlink" title="样本"></a>样本</h1><p><a href="https://wenku.baidu.com/view/81a23a7e6bec0975f565e2c9.html?re=view" target="_blank" rel="external">个人信用报告（银行专业版）样本</a></p>
<h1 id="基础信息"><a href="#基础信息" class="headerlink" title="基础信息"></a>基础信息</h1><ul>
<li>查询时间：央行系统收到查申请人提出查询申请的时间</li>
<li>报告时间：系统收到查询申请后，生成查询人的信用报告的时间</li>
<li>账户数：名下分别有几个信用卡账户、几笔住房贷款、几笔其他贷款</li>
<li>未销户账户数：查询人名下未销户（含正在使用和尚未激活）的信用卡账户数量</li>
<li>未结清账户数：查询人名下未结清住房贷款和其他贷款的账户数量</li>
<li>透支余额：准贷记卡欠银行钱的数量（包含本金和利息）</li>
<li>已使用额度：贷记卡欠银行钱的数量（包含本金和利息）</li>
<li>逾期金额：截至还款日的最后期限，仍未按时或足额偿还的金额，以及由此产生的利息（含罚息）和费用（包括超限费和滞纳金）</li>
<li>公共记录：含最近5年内的欠税记录、法院民事判决记录、强制执行记录、行政处罚记录、电信欠费记录</li>
<li>查询记录：何机构或何人在何时以何种理由查询过此人的信用报告</li>
</ul>
<h1 id="进阶信息"><a href="#进阶信息" class="headerlink" title="进阶信息"></a>进阶信息</h1><h2 id="账户数"><a href="#账户数" class="headerlink" title="账户数"></a>账户数</h2><p>账户数不等同于信用卡张数，而是等于信用卡记录数</p>
<h3 id="同币种信用卡合并显示"><a href="#同币种信用卡合并显示" class="headerlink" title="同币种信用卡合并显示"></a>同币种信用卡合并显示</h3><p>民生银行（持有十张卡）</p>
<ul>
<li>都是人民币账户：信用报告上显示1条关于民生银行信用卡的记录</li>
<li>都是双币账户：信用报告上显示2条关于民生银行信用卡的记录</li>
<li>都是N币账户：信用报告上显示N条关于民生银行信用卡的记录</li>
</ul>
<h3 id="同币种信用卡不合并显示"><a href="#同币种信用卡不合并显示" class="headerlink" title="同币种信用卡不合并显示"></a>同币种信用卡不合并显示</h3><p>工商银行（持有十张卡）：</p>
<ul>
<li>都是人民币账户：信用报告上显示10条关于工商银行信用卡的记录</li>
<li>都是双币账户：信用报告上显示20条关于工商银行信用卡的记录</li>
<li>都是N币账户：信用报告上显示N0条关于工商银行信用卡的记录</li>
</ul>
<h3 id="合并账单"><a href="#合并账单" class="headerlink" title="合并账单"></a>合并账单</h3><p>广发银行（持有十张卡）：</p>
<p>显示为1条信用记录，包含10张卡的消费记录，10张卡的账单日和还款日一致</p>
<h3 id="不合并账单"><a href="#不合并账单" class="headerlink" title="不合并账单"></a>不合并账单</h3><p>中国银行（持有十张卡）：</p>
<p>显示为10条信用记录，每条包含1张卡的消费记录，10张卡的账单日和还款日可以不一致</p>
<h3 id="还款不需要每张卡分别还"><a href="#还款不需要每张卡分别还" class="headerlink" title="还款不需要每张卡分别还"></a>还款不需要每张卡分别还</h3><p>浦发银行（持有十张卡）：</p>
<p>还款只需要还其中1张即可，还清了其中1张卡的账单，即还清所有卡的账单了。</p>
<p>###还款需要每张卡分别还 </p>
<p>农业银行（持有十张卡）：</p>
<p>还款需要还每一张的信用卡，把每一张信用卡的账单都还清，才还清所有卡的账单。</p>
<h2 id="报告的延迟性"><a href="#报告的延迟性" class="headerlink" title="报告的延迟性"></a>报告的延迟性</h2><ul>
<li>如果某人申请了新的信用卡，或者办理了新的贷款，信报上并不会第一时间显示出查询记录、信用卡记录、贷款记录</li>
<li>信用卡的已使用额度和账单并不是实时的，一般银行会每一个月或者每两个月上报数据，也就意味着个人征信报告的信用卡数据一般一到两个月更新一次。</li>
<li>银行贷款和其他贷款机构的贷款记录一般会在1个星期甚至1个月以上的时间才会上报，并在信报上体现出来。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <p class="site-author-name" itemprop="name">Yuanyi Wu</p>
            <p class="site-description motion-element" itemprop="description">朝闻道 夕死可矣</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wu-yuanyi" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/yuanyi.wu.39" target="_blank" title="FB Page">
                  
                    <i class="fa fa-fw fa-facebook"></i>FB Page</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yuanyi Wu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">Theme &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
