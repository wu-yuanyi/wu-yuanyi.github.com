<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="朝闻道 夕死可矣">
<meta property="og:type" content="website">
<meta property="og:title" content="WYY's Blog">
<meta property="og:url" content="http://wu-yuanyi.github.io/page/3/index.html">
<meta property="og:site_name" content="WYY's Blog">
<meta property="og:description" content="朝闻道 夕死可矣">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WYY's Blog">
<meta name="twitter:description" content="朝闻道 夕死可矣">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wu-yuanyi.github.io/page/3/"/>





  <title>WYY's Blog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WYY's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">JUST DO IT</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2017/11/21/Loan/地址清洗/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/21/Loan/地址清洗/" itemprop="url">中文地址清洗</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-21T12:50:20+07:00">
                2017-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Loan/" itemprop="url" rel="index">
                    <span itemprop="name">Loan</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="中文分词的基本原则"><a href="#中文分词的基本原则" class="headerlink" title="中文分词的基本原则"></a>中文分词的基本原则</h2><ul>
<li>颗粒度越大越好</li>
</ul>
<p>分词结果的颗粒度越大（即单词的字数越多），所能表示的含义越确切。如：“公安局长”可以分为“公安 局长”、“公安局 长”、“公安局长”，但是要用于语义分析，则“公安局长”的分词结果最好（前提是所使用的词典中有这个词）。</p>
<ul>
<li>切分结果中非词典词越少越好，单字词典词数越少越好<ul>
<li>非词典词：不包含在词典中的单字</li>
<li>单字词典词：可以独立运用的单字，如：的、了、和、你、我、他</li>
</ul>
</li>
</ul>
<p>如：“技术和服务”，可以分为“技术 和服 务”以及“技术 和 服务”。“务”字无法独立成词（即词典中没有），但“和”字可以单独成词（词典中要包含），因此“技术 和服 务”有1个非词典词，而“技术 和 服务”有0个非词典词，因此选用后者。</p>
<ul>
<li>总体词数越少越好</li>
</ul>
<p>在相同字数的情况下，总词数越少，说明语义单元越少，那么相对的单个语义单元的权重会越大，因此准确性会越高。</p>
<h2 id="匹配算法"><a href="#匹配算法" class="headerlink" title="匹配算法"></a>匹配算法</h2><h3 id="最大匹配算法"><a href="#最大匹配算法" class="headerlink" title="最大匹配算法"></a>最大匹配算法</h3><p>最大匹配是指以词典为依据，取词典中最长单词为第一个次取字数量的扫描串，在词典中进行扫描（为提升扫描效率，还可以跟据字数多少设计多个字典，然后根据字数分别从不同字典中进行扫描）。例如：词典中最长词为“中华人民共和国”共7个汉字，则最大匹配起始字数为7个汉字。然后逐字递减，在对应的词典中进行查找。</p>
<h3 id="正向最大匹配算法"><a href="#正向最大匹配算法" class="headerlink" title="正向最大匹配算法"></a>正向最大匹配算法</h3><p>以“我们在野生动物园”为例，词典中最长词为“中华人民共和国”。</p>
<p>正向即从前往后取词，从7-&gt;1，每次减一个字，直到词典命中或剩下1个单字。</p>
<p>第1轮第1次：7字词典中扫描“我们在野生动物”，无；</p>
<p>第1轮第2次：6字词典中扫描“我们在野生动”，无；</p>
<p>第1轮第3次：5字词典中扫描“我们在野生”，无；</p>
<p>第1轮第4次：4字词典中扫描“我们在野”，无；</p>
<p>第1轮第5次：3字词典中扫描“我们在”，无；</p>
<p>第1轮第6次：2字词典中扫描“我们”，有；</p>
<p>扫描中止，输出第1个词为“我们”，去除第1个词后开始第2轮扫描。</p>
<p>第2轮第1次：7字词典中扫描“在野生动物园玩”，无；</p>
<p>第2轮第2次：6字词典中扫描“在野生动物园”，无；</p>
<p>第2轮第3次：5字词典中扫描“在野生动物”，无；</p>
<p>第2轮第4次：4字词典中扫描“在野生动”，无；</p>
<p>第2轮第5次：3字词典中扫描“在野生”，无；</p>
<p>第2轮第6次：2字词典中扫描“在野”，有；</p>
<p>扫描中止，输出第2个词为“在野”，去除第2个词后开始第3轮扫描。</p>
<p>第3轮第1次：5字词典中扫描“生动物园玩”，无；</p>
<p>第3轮第2次：4字词典中扫描“生动物园”，无；</p>
<p>第3轮第3次：3字词典中扫描“生动物”，无；</p>
<p>第3轮第4次：2字词典中扫描“生动”，有；</p>
<p>扫描中止，输出第3个词为“生动”，去除第3个词后开始第4轮扫描。</p>
<p>第4轮第1次：3字词典中扫描“物园玩”，无；</p>
<p>第4轮第2次：2字词典中扫描“物园”，无；</p>
<p>第4轮第3次：1字词典中扫描“物”，无；</p>
<p>扫描中止，输出第4个词为“物”，非词典词数加1，去除第4个词后开始第5轮扫描。</p>
<p>第5轮第1次：2字词典中扫描“园玩”，无；</p>
<p>第5轮第2次：1字词典中扫描“园”，有；</p>
<p>扫描中止，输出第5个词为“园”，单字词典词数加1，去除第5个词后开始第6轮扫描。</p>
<p>第6轮第1次：1字词典中扫描“玩”，有；</p>
<p>扫描中止，输出第6个词为“园”，单字词典词数加1，扫描结束。</p>
<p>最终切分结果为：“我们/在野/生动/物/园/玩”，其中，单字词典词数为2，非词典词数为1。</p>
<h3 id="逆向最大匹配算法"><a href="#逆向最大匹配算法" class="headerlink" title="逆向最大匹配算法"></a>逆向最大匹配算法</h3><p>以“我们在野生动物园”为例，词典中最长词为“中华人民共和国”。</p>
<p>逆向即从后往前取词，从7-&gt;1，每次减一个字，直到词典命中或剩下1个单字。</p>
<p>第1轮第1次：7字词典中扫描“在野生动物园玩”，无；</p>
<p>第1轮第2次：6字词典中扫描“野生动物园玩”，无；</p>
<p>第1轮第3次：5字词典中扫描“生动物园玩”，无；</p>
<p>第1轮第4次：4字词典中扫描“动物园玩”，无；</p>
<p>第1轮第5次：3字词典中扫描“物园玩”，无；</p>
<p>第1轮第6次：2字词典中扫描“园玩”，无；</p>
<p>第1轮第7次：1字词典中扫描“玩”，有；</p>
<p>扫描中止，输出第1个词为“玩”，单字词典词数加1，去除第1个词后开始第2轮扫描。</p>
<p>第2轮第1次：7字词典中扫描“们在野生动物园”，无；</p>
<p>第2轮第2次：6字词典中扫描“在野生动物园”，无；</p>
<p>第2轮第3次：5字词典中扫描“野生动物园”，有；</p>
<p>扫描中止，输出第2个词为“动物”，去除第2个词后开始第3轮扫描。</p>
<p>第3轮第1次：3字词典中扫描“我们在”，无；</p>
<p>第3轮第2次：2字词典中扫描“们在”，无；</p>
<p>第3轮第3次：1字词典中扫描“在”，有；</p>
<p>扫描中止，输出第3个词为“玩”，单字词典词数加1，去除第3个词后开始第4轮扫描。</p>
<p>第4轮第1次：2字词典中扫描“我们”，有；</p>
<p>扫描中止，输出第4个词为“我们”，扫描结束。</p>
<p>最终切分结果为：“我们/在/野生动物园/玩”，其中，单字词典词数为2，非词典词数为0。</p>
<h3 id="双向最大匹配算法"><a href="#双向最大匹配算法" class="headerlink" title="双向最大匹配算法"></a>双向最大匹配算法</h3><p>正向、逆向两种算法都切一遍，然后根据大颗粒度词越多越好，非词典词和单字词越少越好的原则，选取其中一种分词结果输出。</p>
<ul>
<li>非词典词数：越少越好</li>
<li>单字词典词数：越少越好</li>
<li>总词数：越少越好</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2017/09/25/SAS/SAS编程演义9-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/SAS/SAS编程演义9-10/" itemprop="url">《SAS编程演义》笔记（9-10章）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-25T10:09:39+07:00">
                2017-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SAS/" itemprop="url" rel="index">
                    <span itemprop="name">SAS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="拙中藏巧混天成：统计表格"><a href="#拙中藏巧混天成：统计表格" class="headerlink" title="拙中藏巧混天成：统计表格"></a>拙中藏巧混天成：统计表格</h2><h3 id="医药科研"><a href="#医药科研" class="headerlink" title="医药科研"></a>医药科研</h3><ul>
<li>基线信息表格：介绍人群基本情况</li>
<li>危险因素表格：会在表格中给出事件频数和百分比、粗的效应值及其95%CI和P值</li>
<li>结局效应表格：横款目为终点指标，纵款目除了分组信息，还有效应量</li>
<li>亚组分析表格：最重要的信息是需要提供交互作用校验的结果，通常以森林图的形式展示</li>
</ul>
<h3 id="统计汇总过程"><a href="#统计汇总过程" class="headerlink" title="统计汇总过程"></a>统计汇总过程</h3><p>一个统计过程中只能获得一种变量（分类、连续）的统计数据，款目形式不便统一。</p>
<ul>
<li>RTF（Rich Text File）可直接用Word打开编辑</li>
<li>journal3a是最贴近三线表的样式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">ods tagsets.rtf file=&quot;table.rtf&quot; style=journal3a; /**/</div><div class="line">proc freq data=sashelp.heart;</div><div class="line">    table bp_status*sex / nopercent norow;</div><div class="line">run;</div><div class="line">ods tagsets.rtf close;</div><div class="line"></div><div class="line">ods tagsets.etf file=&quot;table2.rtf&quot; style=journal3a;</div><div class="line">proc means data=sashelp.heart mean std maxdec=2;</div><div class="line">    class sex;</div><div class="line">    var height;</div><div class="line">run;</div><div class="line">ods tagsets.rtf close;</div></pre></td></tr></table></figure>
<h3 id="PROC-TABULATE"><a href="#PROC-TABULATE" class="headerlink" title="PROC TABULATE"></a>PROC TABULATE</h3><p>能一次性实现多种变量的统计需求，也能比较灵活的组合表格形式，但是仍达不到标准三线表的要求，而且也无法计算统计量和P值。</p>
<ul>
<li>CLASS语句申明分类变量</li>
<li>VAR语句申明分析变量</li>
<li>TABLE语句设置表格形式，逗号“,”作为页、行、列等纬度的间隔符，星号“*”作为变量与其显示格式、统计关键字的关联符，括号“()”用来强制分组。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">ods tagsets.rtf file=&quot;table4.rtf&quot; style=journal3a;</div><div class="line">    title &quot;Table 1. Blood Pressure and Height by Sex&quot;;</div><div class="line">proc tabulate data=sashelp.heart;</div><div class="line">    class sex bp_status;</div><div class="line">    var height;</div><div class="line">    table sex, bp_status*(n rowpctn) height*(mean std);</div><div class="line">run;</div><div class="line">ods tagsets.rtf cloase;</div><div class="line"></div><div class="line">ods tagsets.rtf file=&quot;table5.rtf&quot; style=journal3a;</div><div class="line">    title &quot;Table 1. Blood Pressure and Height by Sex&quot;;</div><div class="line">proc tabulate data=sashelp.heart;</div><div class="line">    class sex bp_status;</div><div class="line">    var height;</div><div class="line">    table bp_status*(n colpctn) height*(mean std), sex;</div><div class="line">run;</div><div class="line">ods tagsets.rtf cloase;</div></pre></td></tr></table></figure>
<h3 id="PROC-REPORT"><a href="#PROC-REPORT" class="headerlink" title="PROC REPORT"></a>PROC REPORT</h3><p>纵款目无法用分组变量，横款目值没有缩进，统计变量之间没有连字符，无法获得检验统计量和P值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ods tagsets.rtf file=&quot;table6.rtf&quot; style=journal3a;</div><div class="line">ods escapechar=&apos;^&apos;;</div><div class="line">    title &quot;Table 6, Height and Weight by Gender&quot;;</div><div class="line">proc report data=sashelp.class nowd;</div><div class="line">    column sex height, (&quot;^R&apos;\brdrb\brdrs&apos;&quot; mean std) weight, (&quot;^R&apos;\brdrb\brdrs&apos;&quot; mean std);</div><div class="line">    define sex/group;</div><div class="line">    define height/analysis format=5.2;</div><div class="line">    define weight/analysis format=5.2;</div><div class="line">run;</div><div class="line">ods tagsets.rtf close;</div></pre></td></tr></table></figure>
<h3 id="完美三线图"><a href="#完美三线图" class="headerlink" title="完美三线图"></a>完美三线图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line">/*1 血压状态数据整理*/</div><div class="line">/*1.1 获取频数百分比*/</div><div class="line">proc freq data=sashelp.heart; </div><div class="line">    table bp_status*sex /missing nopercent outpct out=desc1;</div><div class="line">run;</div><div class="line">data desc1;</div><div class="line">    set desc1;</div><div class="line">    length value $25;</div><div class="line">    value = compress(put(count, 6.)) || &apos; (&apos; || compress (put(pct_col, 4.1)) ||&apos;)&apos;;</div><div class="line">run;</div><div class="line"></div><div class="line">/*1.2 转置，性别作为列*/</div><div class="line">proc transpose data=desc1 out=desc1(drop=_name_) prefix=col;</div><div class="line">    var value;</div><div class="line">    by bp_status;</div><div class="line">    id sex;</div><div class="line">run;</div><div class="line"></div><div class="line">/*1.3 获取卡方检验P值*/</div><div class="line">proc freq data=sashelp.heart;</div><div class="line">    table bp_status*sex / norow nocol nopercent chisq;</div><div class="line">    output out=pvalue1(keep=p_pchi rename=(p_pchi=pvalue)) pchi;</div><div class="line">run;</div><div class="line"></div><div class="line">/*1.4 合并变量标签，描述数据，P值*/</div><div class="line">data dslabel1;</div><div class="line">    set pvalue1;</div><div class="line">    length label $ 85;</div><div class="line">    label=cats(&quot;^S=&#123;font_weight=bold&#125;&quot;, &quot;Blood presure status&quot;); /*RTF代码，加粗标签*/</div><div class="line">run;</div><div class="line"></div><div class="line">data merge1(keep=label col: pvalue);</div><div class="line">    set dslabel1 desc1;</div><div class="line">    if _n_&gt;1 then label=&quot;^&#123;nbspace 6&#125;&quot; || bp_status; /*RTF代码，增加缩进*/</div><div class="line">run;</div><div class="line"></div><div class="line">/*2 身高数据整理*/</div><div class="line">/*2.1 获取描述数据*/</div><div class="line">ods output summary=desc2;</div><div class="line">proc means data=sashelp.heart mean std;</div><div class="line">    class sex;</div><div class="line">    var height;</div><div class="line">run;</div><div class="line">data desc2(keep=sex meanstd);</div><div class="line">    set desc2;</div><div class="line">    meanstd = cats(put(height_mean,12.1), &quot;±&quot;, put(height_stddev,12.1));</div><div class="line">run;</div><div class="line"></div><div class="line">/*2.2 转置，性别作为列*/</div><div class="line">proc transpose data=desc2 out=desc2 prefix=col;</div><div class="line">    var meanstd;</div><div class="line">    id sex;</div><div class="line">run;</div><div class="line"></div><div class="line">/*2.3 判断方差齐性，获取t检验p值*/</div><div class="line">ods output equality=eql ttests=ttl;</div><div class="line">proc ttest data=sashelp.heart plots=non;</div><div class="line">    class sex;</div><div class="line">    var height;</div><div class="line">run;</div><div class="line">data pvalue2(keep=Probt rename=(Probt=Pvalue));</div><div class="line">    retain equV;</div><div class="line">    set eql ttl;</div><div class="line">    if ProbF&lt;0.05 then equV=0;</div><div class="line">    else equV=1;</div><div class="line">    if (equV=1 and variances=&quot;Equal&quot;) or (equV=0 and variances=&quot;Unequal&quot;);</div><div class="line">run;</div><div class="line"></div><div class="line">/*2.4 合并变量标签，描述数据，p值*/</div><div class="line">data merge2(keep=label col: pvalue);</div><div class="line">    length label $85;</div><div class="line">    merge desc2 pvalue2;</div><div class="line">    label=cats(&quot;^S=&#123;font_weight=bold&#125;&quot;, &quot;Height (in)&quot;); /*RTF代码，加粗标签*/</div><div class="line">run;</div><div class="line"></div><div class="line">/*3 合并数据*/</div><div class="line">data dsreport;</div><div class="line">    set merge:;</div><div class="line">run;</div><div class="line"></div><div class="line">/*4 Report输出*/</div><div class="line">options nodate nonumber missing=&apos; &apos;;</div><div class="line">ods tagsets.rtf file=&quot;table6.rtf&quot; style=journal3a;</div><div class="line">ods escapecha=&apos;^&apos;;</div><div class="line">    title &quot;Table 1.Blood Presure and Height by Sex&quot;;</div><div class="line">proc report data=dsreport nowd;</div><div class="line">    column label colfemale colmale pvalue;</div><div class="line">    define label / display &quot;Variables&quot;;</div><div class="line">    define colfemale / display &quot;Female&quot; right;</div><div class="line">    define colmale / display &quot;Male&quot; right;</div><div class="line">    define pvalue / analysis &quot;P Value&quot; f=pvalue6.4;</div><div class="line">run;</div><div class="line">footnote1 j=center height=10pt &quot;^&#123;nbspace&#125;Note: This is a demo&quot;;</div><div class="line">ods tagsets.rtf close;</div></pre></td></tr></table></figure>
<h2 id="一缕檀烟万佛名：宏中奥秘"><a href="#一缕檀烟万佛名：宏中奥秘" class="headerlink" title="一缕檀烟万佛名：宏中奥秘"></a>一缕檀烟万佛名：宏中奥秘</h2><p>###宏</p>
<p>SAS宏由宏语言和宏处理器构成。宏语言是与宏处理器沟通的语言。宏语言中以&amp;开头的是宏变量，以%开头的是SAS宏程序或宏函数。当SAS遇到&amp;或%开头的宏语言时，便触发宏处理器，执行宏操作。</p>
<h3 id="创建宏变量"><a href="#创建宏变量" class="headerlink" title="创建宏变量"></a>创建宏变量</h3><ul>
<li>%LET语句</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">/*文本*/</div><div class="line">%let bookname1=Romance of SAS Program;</div><div class="line">%let bookname2=SAS编程演义;</div><div class="line">%let address1=%str(Author%&apos;s address);</div><div class="line">%let address2=%nrstr(ShanghaiTech&amp;SMMU);</div><div class="line"></div><div class="line">/*数字*/</div><div class="line">%let phone1=13800137000;</div><div class="line">%let phone2=;</div><div class="line"></div><div class="line">/*算术表达式*/</div><div class="line">%let ex1=99+1;</div><div class="line">%let ex2=99.9+0.1;</div><div class="line"></div><div class="line">/*计算算术表达式*/</div><div class="line">%let ex3=%eval(99+1);</div><div class="line">%let ex4=%sysevalf(99.9+0.1);</div><div class="line"></div><div class="line">/*程序*/</div><div class="line">%let prg=%str(proc print data=sashelp.classr;run;);</div><div class="line"></div><div class="line">/*查看结果*/</div><div class="line">%put &amp;bookname1 &amp;bookname2 &amp;address1 &amp;address2 &amp;phone1 &amp;phone2 &amp;ex1 &amp;ex2 &amp;ex3 &amp;ex4 &amp;prg;</div></pre></td></tr></table></figure>
<ul>
<li>%GLOBAL申明一个全局宏变量（无法赋值），既可以在宏程序内部，也可以在外部。</li>
<li>%LOCAL申明一个局部宏变量（无法赋值），只能在宏程序内部。<ul>
<li>确保宏程序内部定义的宏变量不会因为同名重写全局宏变量的值</li>
<li>确保宏程序执行完毕后，这些宏变量立即消逝</li>
</ul>
</li>
<li>SQL里SELECT语句的INTO从句，可产生一个或一系列宏变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/*单个宏变量*/</div><div class="line">proc sql noprint;</div><div class="line">    select count(name) into:nname from sashelp.class;</div><div class="line">quit;</div><div class="line">%put &amp;nname;</div><div class="line"></div><div class="line">/*宏变量列表*/</div><div class="line">proc sql noprint;</div><div class="line">    select name into:namelist separated by &quot;,&quot; from sashelp.class;</div><div class="line">quit;</div><div class="line">%put &amp;namelist;</div></pre></td></tr></table></figure>
<ul>
<li>DATA步的SYMPUT和SYMPUTX（去除首尾空格）语句。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/*单个宏变量*/</div><div class="line">data _null_;</div><div class="line">set sashelp.class end=last;</div><div class="line">if last then call symput(&apos;nname&apos;,_n_);</div><div class="line">run;</div><div class="line">%put &amp;nname;</div><div class="line"></div><div class="line">/*宏变量列表*/</div><div class="line">data _nuul_;</div><div class="line">set sashelp.calss;</div><div class="line">call symputx(cats(&apos;name&apos;,_n_),name);</div><div class="line">run;</div><div class="line">%put &amp;namelist;</div></pre></td></tr></table></figure>
<ul>
<li>宏程序的宏参数会创建局部宏变量</li>
<li>%WINDOWS语句</li>
<li>宏程序中的%DO语句</li>
<li>ODS OUTPUT语句的MATCH_ALL选项</li>
</ul>
<h3 id="宏符号表与作用域"><a href="#宏符号表与作用域" class="headerlink" title="宏符号表与作用域"></a>宏符号表与作用域</h3><p>宏符号表（Macro Symbol Table）存储着宏变量与其对应的值。</p>
<ul>
<li>全局宏符号表，SAS启动时，系统自动创建，其中存储的内容有：<ul>
<li>系统自带的宏变量和值</li>
<li>open code（宏程序外）环境下，用%LET语句创建的宏变量</li>
<li>宏程序定义中，用%GLOBAL申明的宏变量</li>
<li>DATA步中CALL SYMPUTX语句中申明了全局符号表</li>
<li>PROC SQL中SELECT语句的INTO从句创建的宏变量</li>
</ul>
</li>
<li>局部宏符号表，SAS执行宏程序时，系统自动创建，其中存储的内容有：<ul>
<li>由宏程序的宏参数创建的宏变量</li>
<li>宏程序中由%LET定义的宏变量，且在全局宏变量中没有同名宏变量</li>
<li>宏程序中由%LOCAL定义的宏变量</li>
</ul>
</li>
<li>判断是全局还是局部<ul>
<li>采用%PUT语句的选项_USER_、_LOCAL_、_GLOBAL_查看符号表</li>
<li>采用系统自带的宏函数%SYMLOCAL、%SYMGLOBAL进行判定</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">%macro testMacroVar(a=, b=);</div><div class="line">%put 所有自定义宏变量;</div><div class="line">%put _user_;</div><div class="line">%put 所有局部宏变量;</div><div class="line">%put _local_;</div><div class="line">%put 所有全局宏变量;</div><div class="line">%put _global_;</div><div class="line">%put sysver是否全局宏变量： %symglobl(sysver);</div><div class="line">%put a是否全局宏变量： %symglobl(a);</div><div class="line">%put b是否局部宏变量： %symlocal(b);</div><div class="line">%mend;</div><div class="line">%testMacroVar(a=Stats, b=Thinking)</div></pre></td></tr></table></figure>
<h3 id="掩蔽宏变量"><a href="#掩蔽宏变量" class="headerlink" title="掩蔽宏变量"></a>掩蔽宏变量</h3><p>掩蔽（masking）：将符号当作普通的文本对待，不使用其特殊含义，有的文档也称为引用（quoting）。</p>
<ul>
<li>需要掩蔽的符号：<ul>
<li>运算符：如+ - * / &lt; &gt; = ¬ ^ ~ |</li>
<li>助记符：如 AND OR NOT EQ NE LE LT GE GT IN</li>
<li>其他：bank , ; “ “ ‘ ’ ( ) #</li>
</ul>
</li>
<li>没有配对的符号，如 “ ‘ ( )，使用%B系列的函数掩蔽</li>
<li>宏触发器 &amp; %，使用%NR系列的引用函数</li>
<li>移除掩蔽主要发生在程序编译后、程序运行后、%UNQUOTE函数后</li>
</ul>
<h3 id="显示宏变量值"><a href="#显示宏变量值" class="headerlink" title="显示宏变量值"></a>显示宏变量值</h3><ul>
<li>系统选项SYMBOLGEN</li>
<li>%PUT语句</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">options symbolgen;</div><div class="line">%let title1=SAS编程演义;</div><div class="line">%let title2=数据整理与图表呈现;</div><div class="line">%let title=&amp;title1.:&amp;title2;</div><div class="line"></div><div class="line">options nosymbolgen;</div><div class="line">%let title1=SAS编程演义;</div><div class="line">%let title2=数据整理与图表呈现;</div><div class="line">%let title=&amp;title1.:&amp;title2;</div><div class="line">%put title1和title2合并后的title解析为：&amp;title;</div><div class="line"></div><div class="line">%put _all_; /*显示所有宏变量*/</div><div class="line">%put _automatic_; /*显示所有自动宏变量*/</div><div class="line">%put _user_; /*显示所有自定义宏变量*/</div><div class="line">%put _global_; /*显示所有全局宏变量*/</div><div class="line">%put _local_; /*显示所有局部宏变量*/</div></pre></td></tr></table></figure>
<h3 id="引用宏变量"><a href="#引用宏变量" class="headerlink" title="引用宏变量"></a>引用宏变量</h3><ul>
<li>直接引用</li>
</ul>
<p>如果是用宏变量给DATA步变量赋具体的值，需用引号引起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">%let bookname2017=SAS编程演义;</div><div class="line">%let year=2017;</div><div class="line">data tmp;</div><div class="line">    name=&quot;&amp;bookname2017&quot;;</div><div class="line">    year=&amp;year;</div><div class="line">run;</div></pre></td></tr></table></figure>
<ul>
<li>间接引用</li>
</ul>
<p>SAS在解析时，会将两个连续的&amp;&amp;解析为一个&amp;，然后再次进行解析，知道&amp;全被解析完</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">%let bookname2017=SAS编程演义;</div><div class="line">%let year=2017;</div><div class="line">data tmp;</div><div class="line">    name=&quot;&amp;bookname&amp;&amp;year&quot;;</div><div class="line">run;</div><div class="line"></div><div class="line">%let L1=L2;</div><div class="line">%let L2=L3;</div><div class="line">%put &amp;L1; /*L2*/</div><div class="line">%put &amp;&amp;L1; /*&amp;L1 -&gt; L2*/</div><div class="line">%put &amp;&amp;&amp;L1; /*&amp;L2 -&gt; L3*/</div></pre></td></tr></table></figure>
<ul>
<li>合并宏变量与普通文本</li>
</ul>
<p>宏变量后面带一个点号，用以标识宏变量的结束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">%let bookname2017=SAS编程演义;</div><div class="line">%let lib=sashelp;</div><div class="line">data class;</div><div class="line">    set &amp;lib..class;</div><div class="line">    bookname=&quot;&amp;bookname2017.:数据整理与图表呈现&quot;;</div><div class="line">run;</div></pre></td></tr></table></figure>
<h3 id="宏程序定义与调用"><a href="#宏程序定义与调用" class="headerlink" title="宏程序定义与调用"></a>宏程序定义与调用</h3><p><strong>%macro macro_name</strong> &lt;parameter_list&gt; &lt;/option(s)\&gt;</p>
<p>​    &lt;macro_text&gt;</p>
<p><strong>%mend</strong> &lt;macro_name&gt;;</p>
<p><strong>%macro_name</strong> &lt;parameter_list&gt;</p>
<ul>
<li><strong>macro_name</strong>：宏程序名称，需要符合SAS命名规范，不能以SYS、AF、DM开头，不能用SAS的保留字，以免冲突</li>
<li>parameter_list：宏参数，通过宏程序定义的局部变量，便于在宏文本中应用。参数通过逗号隔开<ul>
<li>位置宏参数：按位置顺序定义识别 &lt;positional-parameter-1&gt;&lt;, positional-parameter-2…&gt;</li>
<li>关键字宏参数：按名字=识别 &lt;keyword-parameter=&lt;value&gt; &lt;, keyword-parameter-2=&lt;value&gt; …&gt;&gt;</li>
</ul>
</li>
<li><em>option(s)</em>：比如加密选项secure，存储选项store</li>
<li>macro_text：宏文本是宏的主体，里面包括宏语句、DATA步语句、PROC语句等</li>
<li>宏参数不是必需的，位置宏参数和关键字宏参数可以混用，但位置宏参数必须在关键字宏参数前。</li>
<li>宏参数中如有特殊字符如&amp;、%、不配对的括号或引号、其他运算符等，需要做好宏变量的掩蔽。</li>
<li>%mend之后的宏程序名非必需。</li>
<li>调用宏程序时，末尾不需要分号结尾。</li>
</ul>
<h3 id="宏程序的存储加密"><a href="#宏程序的存储加密" class="headerlink" title="宏程序的存储加密"></a>宏程序的存储加密</h3><p>如果为了保护知识产权，想给他人使用宏程序但又不希望他人看到自己开发的宏程序源代码，可以将编译好的宏给别人，且设置为不显示宏的源代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">options mstored sasmstore=demo /*指定存储位置为demo永久库*/</div><div class="line">%macro printds(dataset, obs=5) / store;</div><div class="line">    options nomprint nosource; /*不显示源代码*/</div><div class="line">    proc print data=&amp;dataset(obs=&amp;obs);</div><div class="line">    run;</div><div class="line">%mend printds;</div><div class="line"></div><div class="line">options mstored sasmstore=demo;</div><div class="line">%printds(sashelp.class, obs=5)</div></pre></td></tr></table></figure>
<h3 id="IF-THEN-ELSE选择语句"><a href="#IF-THEN-ELSE选择语句" class="headerlink" title="%IF-%THEN-%ELSE选择语句"></a>%IF-%THEN-%ELSE选择语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">%macro printds(dataset, sex=F, obs=5,);</div><div class="line">    %if &amp;sex eq F %then %str(title &quot;First &amp;obs record for female&quot;;);</div><div class="line">    %else %if &amp;sex eq M %then %str(title &quot;First &amp;obs record for male&quot;;);</div><div class="line">    %else %str(title &quot;Wrong gender&quot;; %abort;);</div><div class="line">    proc print data=&amp;dataset(obs=&amp;obs where=(sex=&quot;&amp;sex&quot;));</div><div class="line">    run;</div><div class="line">%medn printde;</div><div class="line">%printde(sashelp.class,sex=M,obs=5)</div></pre></td></tr></table></figure>
<h3 id="DO组语句"><a href="#DO组语句" class="headerlink" title="%DO组语句"></a>%DO组语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%do</div><div class="line">    语句；</div><div class="line">%end</div></pre></td></tr></table></figure>
<h3 id="DO循环语句"><a href="#DO循环语句" class="headerlink" title="%DO循环语句"></a>%DO循环语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">%macro importcsv;</div><div class="line">%do i=1 %to 100;</div><div class="line">    proc import out=csv&amp;i datafile=&quot;d:\data\casv&amp;i.csv&quot; dbms=csv replace;</div><div class="line">    run;</div><div class="line">%end;</div><div class="line">%mend;</div><div class="line"></div><div class="line">%importcsv</div></pre></td></tr></table></figure>
<h3 id="DO-WHILE语句"><a href="#DO-WHILE语句" class="headerlink" title="%DO-%WHILE语句"></a>%DO-%WHILE语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">%macro importcsv;</div><div class="line">%let i=1;</div><div class="line">%do %while(&amp;i&lt;=100);</div><div class="line">    proc import out=csv&amp;i datafile=&quot;d:\data\casv&amp;i.csv&quot; dbms=csv replace;</div><div class="line">    run;</div><div class="line">    %let i=&amp;i+1;</div><div class="line">%end;</div><div class="line">%mend;</div><div class="line"></div><div class="line">%importcsv</div></pre></td></tr></table></figure>
<h3 id="DO-UNTIL语句"><a href="#DO-UNTIL语句" class="headerlink" title="%DO-%UNTIL语句"></a>%DO-%UNTIL语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">%macro importcsv;</div><div class="line">%let i=1;</div><div class="line">%do %until(&amp;i&gt;100);</div><div class="line">    proc import out=csv&amp;i datafile=&quot;d:\data\casv&amp;i.csv&quot; dbms=csv replace;</div><div class="line">    run;</div><div class="line">    %let i=&amp;i+1;</div><div class="line">%end;</div><div class="line">%mend;</div><div class="line"></div><div class="line">%importcsv</div></pre></td></tr></table></figure>
<h3 id="宏函数"><a href="#宏函数" class="headerlink" title="宏函数"></a>宏函数</h3><table>
<thead>
<tr>
<th>类别</th>
<th>宏函数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>字符宏函数</td>
<td>%index</td>
<td>返回字符串第一次出现的位置</td>
</tr>
<tr>
<td></td>
<td>%length</td>
<td>返回字符串长度</td>
</tr>
<tr>
<td></td>
<td>%scan %qscan</td>
<td>按字符串中的位置截取单词</td>
</tr>
<tr>
<td></td>
<td>%substr %qsubstr</td>
<td>截取子字符串</td>
</tr>
<tr>
<td></td>
<td>%upcase %qupcase</td>
<td>转为大写字符</td>
</tr>
<tr>
<td>计算函数</td>
<td>%eval</td>
<td>使用整数运算计算表达式结果</td>
</tr>
<tr>
<td></td>
<td>%sysevalf</td>
<td>使用浮点运算计算表达式结果</td>
</tr>
<tr>
<td>引用函数</td>
<td>%str</td>
<td>编译时掩蔽特殊字符及助记符</td>
</tr>
<tr>
<td></td>
<td>%nrstr</td>
<td>%str 外加宏触发器字符</td>
</tr>
<tr>
<td></td>
<td>%quote</td>
<td>执行时掩蔽特殊、助记、其他字符</td>
</tr>
<tr>
<td></td>
<td>%nrquote</td>
<td>%quote 外加宏触发器字符</td>
</tr>
<tr>
<td></td>
<td>%bquote</td>
<td>执行时掩蔽特殊、助记、其他字符和没有配对的符号</td>
</tr>
<tr>
<td></td>
<td>%nrbquote</td>
<td>%bquote 外加宏触发器字符</td>
</tr>
<tr>
<td></td>
<td>%superq</td>
<td>执行时掩蔽所有字符，且对结果保持</td>
</tr>
<tr>
<td></td>
<td>%unquote</td>
<td>执行时去掉所有特殊、助记字符的掩蔽</td>
</tr>
<tr>
<td>SYS系函数</td>
<td>%sysmacexect</td>
<td>返回宏执行状态</td>
</tr>
<tr>
<td></td>
<td>%sysmacexist</td>
<td>判断宏程序是否已经定义</td>
</tr>
<tr>
<td></td>
<td>%sysmexecdepth</td>
<td>返回宏嵌套的深度</td>
</tr>
<tr>
<td></td>
<td>%sysmexecname</td>
<td>返回指定宏嵌套的深度的宏名称</td>
</tr>
<tr>
<td></td>
<td>%sysfunc %qsysfunc</td>
<td>使用data步函数</td>
</tr>
<tr>
<td></td>
<td>%sysget</td>
<td>返回环境变量的值</td>
</tr>
<tr>
<td></td>
<td>%sysprod</td>
<td>判断SAS产品是否已经授权</td>
</tr>
<tr>
<td>SYM系函数</td>
<td>%symexist</td>
<td>判断宏变量是否已经存在</td>
</tr>
<tr>
<td></td>
<td>%symglobl</td>
<td>判断是否属于全局宏变量</td>
</tr>
<tr>
<td></td>
<td>%symlocal</td>
<td>判断是否属于局部宏变量</td>
</tr>
</tbody>
</table>
<h3 id="宏开发"><a href="#宏开发" class="headerlink" title="宏开发"></a>宏开发</h3><ol>
<li>硬代码实现：先不用任何宏代码，实现具体的任务</li>
<li>移除上一步中的硬代码，该用宏变量、宏参数，如有必要，增加宏语句如以及宏函数</li>
<li>宏代码测试优化：给宏变量赋值，逐步测试宏代码，优化宏代码。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2017/09/19/Loan/规则引擎与Drools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/19/Loan/规则引擎与Drools/" itemprop="url">规则引擎与Drools</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-19T11:00:46+07:00">
                2017-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Loan/" itemprop="url" rel="index">
                    <span itemprop="name">Loan</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h2><h3 id="1-1-规则"><a href="#1-1-规则" class="headerlink" title="1.1 规则"></a>1.1 规则</h3><ul>
<li>每条规则都是一组条件决定的一系列结果</li>
<li>一条规则可能与其他规则共同决定最终结果</li>
<li>可能存在条件互相交叉的规则，此时有必要规定规则的优先级</li>
</ul>
<p>规则作为一种知识，其典型运用就是通过实际情况，根据给定的一组规则，得出结论。这个结论可能是某种静态的结果，也可能是需要进行的一组操作。</p>
<p>规则语言可以分为结构化的（Structured)和基于标记的（Markup，通常为xml）。</p>
<p>常见的结构化的规则描述语言:</p>
<ul>
<li>srl（Structured Rule Language）</li>
<li>drl（Drools Rule Language）</li>
</ul>
<p>常见的基于标记的规则描述语言:</p>
<ul>
<li>RuleML（Rule Markup Language）</li>
<li>SRML（Simple Rule Markup Language）</li>
<li>BRML（Business Rules Markup Language）</li>
<li>SWRL（A Semantic Web Rule Language）</li>
</ul>
<h3 id="1-2-推理机"><a href="#1-2-推理机" class="headerlink" title="1.2 推理机"></a>1.2 推理机</h3><p>运用过程叫做推理。如果由程序来处理推理过程，那么这个程序就叫做推理机/推理引擎（Inference Engine）。推理机是专家系统（专家系统是人工智能的一个分支）的核心模块。</p>
<p>推理引擎根据知识表示的不同采取的控制策略也是不同的，常见的类型包括基于神经网络、基于案例和基于规则的推理机。</p>
<h3 id="1-3-规则引擎"><a href="#1-3-规则引擎" class="headerlink" title="1.3 规则引擎"></a>1.3 规则引擎</h3><p>基于规则的推理机易于理解、易于获取、易于管理，被广泛采用。这种推理引擎被称为“规则引擎”。</p>
<p>在规则引擎中，将知识表达为规则（rules），要分析的情况定义为事实（facts）。二者在内存中的存储分别称为Production Memory和Working Memory。</p>
<ul>
<li>rules和facts：规则引擎接受的输入参数</li>
<li>Pattern Matcher：根据facts找到匹配的rules<ul>
<li>正向推理（Forward-Chaining）：正向推理也叫演绎法，由事实驱动，从 一个初始的事实出发，不断地应用规则得出结论。首先在候选队列中选择一条规则作为启用规则进行推理，记录其结论作为下一步推理时的证据。如此重复这个过程，直到再无可用规则可被选用或者求得了所要求的解为止。</li>
<li>反向推理（Backward-Chaining）：反向推理也叫归纳法，由目标驱动，首先提出某个假设，然后寻找支持该假设的证据，若所需的证据都能找到，说明原假设是正确的；若无论如何都找不到所需要的证据，则说明原假设不成立，此时需要另做新的假设。</li>
</ul>
</li>
<li>Agenda：管理PatternMatcher挑选出来的规则的执行次序</li>
<li>Execution Engine：在外围负责根据Agenda输出的rules执行具体的操作</li>
</ul>
<h3 id="1-4-规则引擎的作用"><a href="#1-4-规则引擎的作用" class="headerlink" title="1.4 规则引擎的作用"></a>1.4 规则引擎的作用</h3><p>规则引擎可以将规则的定义从代码中分离出来，将推理过程封装到规则引擎内部进行处理，这带来几个好处：</p>
<ul>
<li>规则外部化，即有利于规则知识的复用，也可避免改变规则时带来的代码变更问题</li>
<li>由规则引擎使用某种算法进行推理过程，不需要编写复杂晦涩的逻辑判断代码</li>
<li>开发人员的不需要过多关注逻辑判断，可以专注于逻辑处理</li>
</ul>
<h2 id="2-Drools"><a href="#2-Drools" class="headerlink" title="2 Drools"></a>2 Drools</h2><p><a href="https://www.tutorialspoint.com/drools/pdf/drools_sample_drools_program.pdf" target="_blank" rel="external">DROOLS - SAMPLE DROOLS PROGRAM</a></p>
<h3 id="2-1-概览"><a href="#2-1-概览" class="headerlink" title="2.1 概览"></a>2.1 概览</h3><p>完整的drl文件包含以下几个部分：package，import，declares，globals，functions，queries，rules。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.sample</div><div class="line"><span class="keyword">import</span> com.sample.DroolsTest.Message;</div><div class="line"></div><div class="line">rule <span class="string">"Hello World"</span></div><div class="line">  when</div><div class="line">    m : Message(status == Message.HELLO, myMessage : message)</div><div class="line">  then</div><div class="line">    System.out.println(myMessage);</div><div class="line">    m.setMessage(<span class="string">"Goodbye cruel world"</span>);</div><div class="line">    m.setStatus(Message.GOODBYE);</div><div class="line">    update(m);</div><div class="line">end</div><div class="line"></div><div class="line">rule <span class="string">"GoodBye"</span></div><div class="line">  <span class="function">when</span></div><div class="line">    <span class="title">Message</span><span class="params">(status==Message.GOODBYE, myMessage:message)</span></div><div class="line">   then</div><div class="line">    System.out.<span class="title">println</span><span class="params">(myMessage)</span>;</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="2-2-package和import"><a href="#2-2-package和import" class="headerlink" title="2.2 package和import"></a>2.2 package和import</h3><p>与Java类似，drools头部必须要有一个package声明和import声明，且package声明必须放在规则文件的第一行。</p>
<h3 id="2-3-规则定义"><a href="#2-3-规则定义" class="headerlink" title="2.3 规则定义"></a>2.3 规则定义</h3><p>一个规则通常包含三个部分：attribute（属性），LHS（条件部分），RHS（结果部分）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rule <span class="string">"name"</span></div><div class="line">  attributes</div><div class="line">  when</div><div class="line">    LHS</div><div class="line">  then</div><div class="line">    RHS</div><div class="line">end</div></pre></td></tr></table></figure>
<h4 id="2-3-1-LHS（条件部分）"><a href="#2-3-1-LHS（条件部分）" class="headerlink" title="2.3.1 LHS（条件部分）"></a>2.3.1 LHS（条件部分）</h4><ul>
<li>可以包含多个条件，若条件部分为空的话，引擎自动添加一个eval(true)的条件。</li>
<li>多个条件之间可使用and或or连接，默认是and关系。</li>
<li>条件的语法：[绑定变量名:]\Object([field约束])<ul>
<li>绑定变量名：可在该LHS后续的条件中引用</li>
<li>field约束：当前对象里相关字段的条件限制，多个约束之间用”&amp;&amp;”(and)，”||”(or)和”,”(and)连接。约束中可使用的比较操作符包括：&gt;, &gt;=, &lt;, &lt;=, ==, !=, contains, not contains, memberof, not memberof, matches, not matchers</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">when</div><div class="line">  order:Order();</div><div class="line">then</div><div class="line">  ...</div><div class="line"></div><div class="line">when</div><div class="line">  $room : Room( )  #变量名可以是$开头</div><div class="line">  $sprinkler : Sprinkler( room == $room, on == true )</div><div class="line">  not Fire( room == $room )</div><div class="line">then</div><div class="line">  modify( $sprinkler ) &#123; setOn( false ) &#125;;</div><div class="line">  System.out.println( "Turn off the sprinkler for room " + $room.getName() );</div></pre></td></tr></table></figure>
<h4 id="2-3-2-RHS（结果部分）"><a href="#2-3-2-RHS（结果部分）" class="headerlink" title="2.3.2 RHS（结果部分）"></a>2.3.2 RHS（结果部分）</h4><ul>
<li>RHS部分定义了当LHS满足时要进行的操作</li>
<li>RHS中可以编写代码，可以使用LHS部分中定义的绑定变量名以及drl头部定义的全局变量。</li>
<li>虽然可以在RHS中直接写java代码，但不建议代码中有条件判断，否则就违背了使用规则的初衷。</li>
</ul>
<h5 id="2-3-2-1-使用宏函数"><a href="#2-3-2-1-使用宏函数" class="headerlink" title="2.3.2.1 使用宏函数"></a>2.3.2.1 使用宏函数</h5><p>RHS中可以使用宏函数对工作空间进行操作。当调用宏函数后，所有为设置“no-loop”属性的规则都会呗重新分配，符合条件的重新触发。</p>
<p>宏函数都是StatefulSession中定义的方法，包括：</p>
<ul>
<li>insert：将一个Fact对象插入到当前的Working Memory</li>
<li>update：对当前Working Memory中的Fact进行更新</li>
<li>retract：从Working Memory中删除某个Fact对象</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">when</div><div class="line">  ...</div><div class="line">then</div><div class="line">  Customer cus=new Customer();</div><div class="line">  cus.setName("张三");</div><div class="line">  insert(cus);</div><div class="line"></div><div class="line">when </div><div class="line">  $customer:Customer(name=="张三", age&lt;10)</div><div class="line">then</div><div class="line">  $customer.setAge(customer.getAge()+1);</div><div class="line">  update(customer);</div><div class="line"></div><div class="line">when</div><div class="line">  $customer:Customer(name=="张三",age&lt;10)</div><div class="line">then</div><div class="line">  Customer customer=new Customer();</div><div class="line">  customer.setName("张三");</div><div class="line">  customer.setAge($customer.getAge()+1);</div><div class="line">  # 用新对象替换Working Memory中的旧对象</div><div class="line">  update(drools.getWorkingMemory().getFactHandleByIdentity($customer),customer);</div><div class="line"></div><div class="line"></div><div class="line">when</div><div class="line">  $customer:Customer(name=="张三")</div><div class="line">then</div><div class="line">  retract($customer);</div></pre></td></tr></table></figure>
<h5 id="2-3-2-2-modify代码块"><a href="#2-3-2-2-modify代码块" class="headerlink" title="2.3.2.2 modify代码块"></a>2.3.2.2 modify代码块</h5><p>modify代码块用于快速修改并更新(update)某个 Fact 对象的多个属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">modify(fact-expression)&#123;</div><div class="line">  &lt;修改 Fact 属性的表达式&gt;[,&lt;修改 Fact 属性的表达式&gt;*]</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">when</div><div class="line">  $customer:Customer(name==<span class="string">"张三"</span>,age==<span class="number">20</span>);</div><div class="line"><span class="function">then</span></div><div class="line">  <span class="title">modify</span><span class="params">($customer)</span>&#123;</div><div class="line">    setId(<span class="string">"super man"</span>),</div><div class="line">    setAge(<span class="number">30</span>)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h5 id="2-3-2-3-drools宏对象"><a href="#2-3-2-3-drools宏对象" class="headerlink" title="2.3.2.3 drools宏对象"></a>2.3.2.3 drools宏对象</h5><p>通过使用drools宏对象可以实现在规则文件里直接访问 Working Memory，从而获取对当前的 Working Memory的更多控制。</p>
<p>drools宏对象的常用方法包括：</p>
<ul>
<li>drools.getWorkingMemory()：获取当前的 WorkingMemory对象</li>
<li>drools.halt()：在当前规则执行完成后，不再执行 其它未执行的规则</li>
<li>drools.getRule()：得到当前的规则对象</li>
<li>drools.insert(new Object)：向当前的WorkingMemory 当中插入指定的对象，功能与宏函数insert相同</li>
<li>drools.update(new Object)：更新当前的WorkingMemory中指定的对象，功能与宏函数update相同</li>
<li>drools.update(FactHandle Object)：更新当前的WorkingMemory中指定的对象，功能与宏函数update相同</li>
<li>drools.retract(new Object)：从当前的WorkingMemory中删除指 定的对象，功能与宏函数retract相同</li>
</ul>
<h5 id="2-3-2-4-kcontext宏对象"><a href="#2-3-2-4-kcontext宏对象" class="headerlink" title="2.3.2.4 kcontext宏对象"></a>2.3.2.4 kcontext宏对象</h5><p>用来得到当前的KnowledgeRuntime对象，KnowledgeRuntime对象可以实现与引擎的各种交互。</p>
<h4 id="2-3-3-规则属性"><a href="#2-3-3-规则属性" class="headerlink" title="2.3.3 规则属性"></a>2.3.3 规则属性</h4><ul>
<li>salience：设置规则执行的优先级，默认值为0。数字越大越先执行，可以设置为负数，数字相同的使用随机顺序。设置该属性<code>salience 10</code>.</li>
<li>no-loop：默认为false。设置为true时，表示该规则只会被引擎检查一次。引擎内部对Fact更新时，忽略本规则的再次检查。</li>
<li>date-effective：设置规则的开始生效日期，默认接受“dd-MMM-yyyy”格式的字符串。修改日期格式：<code>System.setProperty(&quot;drools.dateformat&quot;,&quot;yyyy-MM-dd&quot;)</code></li>
<li>data-expires：设置规则的过期日期，默认接受“dd-MMM-yyyy”格式的字符串。修改日期格式：<code>System.setProperty(&quot;drools.dateformat&quot;,&quot;yyyy-MM-dd&quot;)</code>。</li>
<li>enabled：设置规则是否可用，默认为true。</li>
<li>dialect：设置规则中使用的编程语言，默认为java，可设置为mvel。获取该属性的设置：<code>drools.getRule().getDialect()</code>，设置该属性<code>dialect mvel</code></li>
<li>duration：指定延迟时间，在另一个线程中触发规则，单位为毫秒。</li>
<li>activation-group：为规则划指定一个活动组（组名为字符串）。同一个活动组中的规则只执行一个，根据优先级(salience)来决定执行哪一个规则。</li>
<li>agenda-group：为规则指定一个议程(agenda)组。指定了议程组的规则只有在该议程组得到焦点时才被触发。</li>
<li>auto-focus：指定了auto-focus属性为true，则该规则自动得到焦点。</li>
<li>ruleflow-group：指定规则流组。</li>
<li>lock-on-active：当在规则上使用ruleflow-group属性或agenda-group属性的时候，将lock-on-action属性 的值设置为 true，可避免因某些 Fact 对象被修改而使已经执行过的规则再次被激活执行。</li>
<li>when</li>
</ul>
<h3 id="2-4-注释"><a href="#2-4-注释" class="headerlink" title="2.4 注释"></a>2.4 注释</h3><ul>
<li>多行注释：<code>/*注释*/</code></li>
<li>单行注视：<code>#注释</code>或 <code>//注释</code></li>
</ul>
<h3 id="2-5-类型声明"><a href="#2-5-类型声明" class="headerlink" title="2.5 类型声明"></a>2.5 类型声明</h3><p>todo</p>
<h3 id="2-6-全局变量"><a href="#2-6-全局变量" class="headerlink" title="2.6 全局变量"></a>2.6 全局变量</h3><p>todo</p>
<h3 id="2-7-函数和import-function"><a href="#2-7-函数和import-function" class="headerlink" title="2.7 函数和import function"></a>2.7 函数和import function</h3><h4 id="2-7-1-函数的定义和使用"><a href="#2-7-1-函数的定义和使用" class="headerlink" title="2.7.1 函数的定义和使用"></a>2.7.1 函数的定义和使用</h4><p>函数是定义在规则文件中的一段代码，用于将规则文件中会被若干个规则复用的业务操作封装起来，减少规则编写的工作量。函数的可见范围是规则函数所在的规则文件。</p>
<p>函数以function定义。可以是void，也可以有返回值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> test</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"></div><div class="line"><span class="function">function <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Customer customer, <span class="keyword">int</span> orderSize)</span> </span>&#123;</div><div class="line">  List ls = <span class="keyword">new</span> ArrayList();</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;orderSize; i++)&#123;</div><div class="line">    Order order=<span class="keyword">new</span> Order();</div><div class="line">    ls.add(order);</div><div class="line">  &#125;</div><div class="line">  customer.setOrder(ls);</div><div class="line">&#125;</div><div class="line"></div><div class="line">rule <span class="string">"rule1"</span></div><div class="line">  when</div><div class="line">    $customer:Customer()</div><div class="line">  <span class="function">then</span></div><div class="line">    <span class="title">setOrder</span><span class="params">($customer,<span class="number">5</span>)</span>;</div><div class="line">    System.out.println(<span class="string">"rule 1 customer has order size:"</span>+$customer.getOrders().size());</div><div class="line">end</div><div class="line"></div><div class="line">rule <span class="string">"rule2"</span></div><div class="line">  when</div><div class="line">    $customer :Customer()</div><div class="line">  <span class="function">then</span></div><div class="line">    <span class="title">setOrder</span><span class="params">($customer,<span class="number">10</span>)</span>;</div><div class="line">    System.out.println(<span class="string">"rule 2 customer has order size:"</span>+$customer.getOrders().size());</div><div class="line">end</div></pre></td></tr></table></figure>
<h4 id="2-7-2-引入静态方法"><a href="#2-7-2-引入静态方法" class="headerlink" title="2.7.2 引入静态方法"></a>2.7.2 引入静态方法</h4><p>实际应用当中，可以考虑使用在java类当中定义静态方法的办法来替代在规则文件当中定义函数。</p>
<p>Drools 提供了一个特殊的 import 语句：import function。通过该 import 语句，可以实现将一个java类中静态方法引入到一个规则文件当中，使得该文件当中的规则可以像使用普通的Drools函数一样来使用java类中某个静态方法。</p>
<h3 id="2-8-查询定义"><a href="#2-8-查询定义" class="headerlink" title="2.8 查询定义"></a>2.8 查询定义</h3><p>查询用于根据条件在当前的 WorkingMemory 当中查找 Fact。</p>
<p>Drools 当中查询可分为两种：</p>
<ul>
<li>不需要外部传入参数</li>
<li>需要外部传入参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">query <span class="string">"testQuery"</span></div><div class="line">  customer:Customer(age&gt;<span class="number">30</span>,orders.size &gt;<span class="number">10</span>)</div><div class="line">end</div><div class="line"></div><div class="line">query <span class="string">"testQuery2"</span>(<span class="keyword">int</span> $age,String $gender)</div><div class="line">  customer:Customer(age&gt;$age,gender==$gender)</div><div class="line">end</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2017/09/14/DataAnalysis/利用python 3进行数据分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/14/DataAnalysis/利用python 3进行数据分析/" itemprop="url">Numpy Basics</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-14T09:18:42+07:00">
                2017-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis/" itemprop="url" rel="index">
                    <span itemprop="name">Data Analysis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Numpy-Basics-Arrays-and-Vectorized-Computation"><a href="#Numpy-Basics-Arrays-and-Vectorized-Computation" class="headerlink" title="Numpy Basics: Arrays and Vectorized Computation"></a>Numpy Basics: Arrays and Vectorized Computation</h3><h4 id="Magic-Methods"><a href="#Magic-Methods" class="headerlink" title="Magic Methods"></a>Magic Methods</h4><table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%quickref</td>
<td>Display the IPython Quick Reference Card</td>
</tr>
<tr>
<td>%magic</td>
<td>Display detailed documentation for all of the available magic commands</td>
</tr>
<tr>
<td>%debug</td>
<td>Enter the interactive debugger at the bottom of the last exception traceback</td>
</tr>
<tr>
<td>%hist</td>
<td>Print command input (and optionally output) history</td>
</tr>
<tr>
<td>%pdb</td>
<td>Automatically enter debugger after any exception</td>
</tr>
<tr>
<td>%paste</td>
<td>Execute preformatted Python code from clipboard</td>
</tr>
<tr>
<td>%cpaste</td>
<td>Open a special prompt for manually pasting Python code to be executed</td>
</tr>
<tr>
<td>%reset</td>
<td>Delete all variables/names defined in interactive namespace</td>
</tr>
<tr>
<td>%page OBJECT</td>
<td>Pretty-print the object and display it through a pager</td>
</tr>
<tr>
<td>%run script.py</td>
<td>Run a Python script inside IPython</td>
</tr>
<tr>
<td>%prun statement</td>
<td>Execute statement with cProfile and report the profiler output</td>
</tr>
<tr>
<td>%time statement</td>
<td>Report the execution time of a single statement</td>
</tr>
<tr>
<td>%timeit statement</td>
<td>Run a statement multiple times to compute an ensemble average execution time; useful for timing code with very short execution time</td>
</tr>
<tr>
<td>%who, %who_ls, %whos</td>
<td>Display variables defined in interactive namespace, with varying levels of information/ verbosity</td>
</tr>
<tr>
<td>%xdel variable</td>
<td>Delete a variable and attempt to clear any references to the object in the IPython internals</td>
</tr>
</tbody>
</table>
<h4 id="Set-print-options"><a href="#Set-print-options" class="headerlink" title="Set print options"></a>Set print options</h4><ul>
<li>Precision</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: x = np.random.random(<span class="number">5</span>)</div><div class="line"></div><div class="line">In [<span class="number">3</span>]: x</div><div class="line">Out[<span class="number">3</span>]: array([ <span class="number">0.11528565</span>,  <span class="number">0.50686134</span>,  <span class="number">0.16554924</span>,  <span class="number">0.77585094</span>,  <span class="number">0.99374836</span>])</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: np.set_printoptions(precision=<span class="number">3</span>)</div><div class="line"></div><div class="line">In [<span class="number">5</span>]: x</div><div class="line">Out[<span class="number">5</span>]: array([ <span class="number">0.115</span>,  <span class="number">0.507</span>,  <span class="number">0.166</span>,  <span class="number">0.776</span>,  <span class="number">0.994</span>])</div></pre></td></tr></table></figure>
<ul>
<li>Scientific notation</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">6</span>]: y = np.array([<span class="number">1.5e-10</span>, <span class="number">1.5</span>, <span class="number">1500</span>])</div><div class="line"></div><div class="line">In [<span class="number">7</span>]: y</div><div class="line">Out[<span class="number">7</span>]: array([  <span class="number">1.500e-10</span>,   <span class="number">1.500e+00</span>,   <span class="number">1.500e+03</span>])</div><div class="line"></div><div class="line">In [<span class="number">8</span>]: np.set_printoptions(suppress=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">In [<span class="number">9</span>]: y</div><div class="line">Out[<span class="number">9</span>]: array([    <span class="number">0.</span> ,     <span class="number">1.5</span>,  <span class="number">1500.</span> ])</div></pre></td></tr></table></figure>
<h4 id="Array-creation-Functions"><a href="#Array-creation-Functions" class="headerlink" title="Array creation Functions"></a>Array creation Functions</h4><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>array</td>
<td>Convert input data (list, tuple, array, or other sequence type) to an ndarray either by inferring a dtype or explicitly specifying a dtype; copies the input data by default</td>
</tr>
<tr>
<td>asarray</td>
<td>Convert input to ndarray, but do not copy if the input is already an ndarray</td>
</tr>
<tr>
<td>arange</td>
<td>Like the built-inrangebut returns an ndarray instead of a list</td>
</tr>
<tr>
<td>ones, ones_like</td>
<td>Produce an array of all 1s with the given shape and dtype; ones_like takes another array and produces a ones array of the same shape and dtype</td>
</tr>
<tr>
<td>zeros, zeros_like</td>
<td>Likeonesandones_likebut producing arrays of 0s instead</td>
</tr>
<tr>
<td>empty, empty_like</td>
<td>Create new arrays by allocating new memory, but do not populate with any values like ones and zeros</td>
</tr>
<tr>
<td>full, full_like</td>
<td>Produce an array of the given shape and dtype with all values set to the indicated “fill value” full_like takes another array and produces a filled array of the same shape and dtype</td>
</tr>
<tr>
<td>eye, identity</td>
<td>Create a square N × N identity matrix (1s on the diagonal and 0s elsewhere)</td>
</tr>
</tbody>
</table>
<p>Why choose np.zeros?  It’s the Fastest.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">2</span>]: size=<span class="number">100000000</span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: %timeit np.full(size, <span class="number">0</span>)</div><div class="line"><span class="number">1</span> loop, best of <span class="number">3</span>: <span class="number">5.41</span> s per loop</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: %timeit np.zeros(size)</div><div class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">21.8</span> µs per loop</div><div class="line"></div><div class="line">In [<span class="number">5</span>]: %timeit np.ones(size)</div><div class="line"><span class="number">1</span> loop, best of <span class="number">3</span>: <span class="number">5.56</span> s per loop</div><div class="line"></div><div class="line">In [<span class="number">6</span>]: %timeit a = np.empty(size); a[:]=<span class="number">0</span></div><div class="line"><span class="number">1</span> loop, best of <span class="number">3</span>: <span class="number">5.02</span> s per loop</div></pre></td></tr></table></figure>
<h4 id="Indexing-and-Slicing"><a href="#Indexing-and-Slicing" class="headerlink" title="Indexing and Slicing"></a>Indexing and Slicing</h4><p>An important first distinction from Python’s built-in lists is that array slices are views on the original array. This means that the data is not copied, and any modifications to the view will be reflected in the source array.</p>
<p>If you want a copy of a slice of an ndarray instead of a view, you will need to explicitly copy the array-for example, array_a[2:4].copy().</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">19</span>]: array_a</div><div class="line">Out[<span class="number">19</span>]: array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</div><div class="line"></div><div class="line">In [<span class="number">20</span>]: slice_a = array_a[<span class="number">2</span>:<span class="number">4</span>]</div><div class="line"></div><div class="line">In [<span class="number">22</span>]: slice_a[:] = <span class="number">9</span></div><div class="line"></div><div class="line">In [<span class="number">23</span>]: array_a</div><div class="line">Out[<span class="number">23</span>]: array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</div></pre></td></tr></table></figure>
<h4 id="Fancy-Indexing"><a href="#Fancy-Indexing" class="headerlink" title="Fancy Indexing"></a>Fancy Indexing</h4><p>Fancy indexing, unlike slicing, always copies the data into a new array. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">2</span>]: arr = np.arange(<span class="number">32</span>).reshape(<span class="number">8</span>,<span class="number">4</span>)</div><div class="line"></div><div class="line">In [<span class="number">3</span>]: arr</div><div class="line">Out[<span class="number">3</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</div><div class="line">       [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</div><div class="line">       [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>],</div><div class="line">       [<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>],</div><div class="line">       [<span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>],</div><div class="line">       [<span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>],</div><div class="line">       [<span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>],</div><div class="line">       [<span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>]])</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: arr[[<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">2</span>],[<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>]]</div><div class="line">Out[<span class="number">4</span>]: array([ <span class="number">4</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">10</span>])</div><div class="line"></div><div class="line">In [<span class="number">5</span>]: arr[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>]][:, [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]]</div><div class="line">Out[<span class="number">5</span>]:</div><div class="line">array([[ <span class="number">4</span>,  <span class="number">7</span>,  <span class="number">5</span>,  <span class="number">6</span>],</div><div class="line">       [<span class="number">20</span>, <span class="number">23</span>, <span class="number">21</span>, <span class="number">22</span>],</div><div class="line">       [<span class="number">28</span>, <span class="number">31</span>, <span class="number">29</span>, <span class="number">30</span>],</div><div class="line">       [ <span class="number">8</span>, <span class="number">11</span>,  <span class="number">9</span>, <span class="number">10</span>]])</div></pre></td></tr></table></figure>
<h4 id="Transposing-Arrays-and-Swapping-Axes"><a href="#Transposing-Arrays-and-Swapping-Axes" class="headerlink" title="Transposing Arrays and Swapping Axes"></a>Transposing Arrays and Swapping Axes</h4><ul>
<li>Transposing is a special form of reshaping that similarly returns a view on the under‐ lying data without copying anything.  </li>
<li>swapaxes similarly returns a view on the data without making a copy. </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">3</span>]: arr = np.arange(<span class="number">15</span>).reshape(<span class="number">3</span>,<span class="number">5</span>)</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: arr</div><div class="line">Out[<span class="number">4</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>],</div><div class="line">       [ <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>],</div><div class="line">       [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]])</div><div class="line"></div><div class="line">In [<span class="number">5</span>]: arr.T</div><div class="line">Out[<span class="number">5</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">5</span>, <span class="number">10</span>],</div><div class="line">       [ <span class="number">1</span>,  <span class="number">6</span>, <span class="number">11</span>],</div><div class="line">       [ <span class="number">2</span>,  <span class="number">7</span>, <span class="number">12</span>],</div><div class="line">       [ <span class="number">3</span>,  <span class="number">8</span>, <span class="number">13</span>],</div><div class="line">       [ <span class="number">4</span>,  <span class="number">9</span>, <span class="number">14</span>]])</div><div class="line"></div><div class="line">In [<span class="number">6</span>]: arr.transpose()</div><div class="line">Out[<span class="number">6</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">5</span>, <span class="number">10</span>],</div><div class="line">       [ <span class="number">1</span>,  <span class="number">6</span>, <span class="number">11</span>],</div><div class="line">       [ <span class="number">2</span>,  <span class="number">7</span>, <span class="number">12</span>],</div><div class="line">       [ <span class="number">3</span>,  <span class="number">8</span>, <span class="number">13</span>],</div><div class="line">       [ <span class="number">4</span>,  <span class="number">9</span>, <span class="number">14</span>]])</div></pre></td></tr></table></figure>
<p><a href="https://stackoverflow.com/questions/32034237/how-does-numpys-transpose-method-permute-the-axes-of-an-array" target="_blank" rel="external">How does NumPy’s transpose() method permute the axes of an array?</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">8</span>]: arr</div><div class="line">Out[<span class="number">8</span>]:</div><div class="line">array([[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</div><div class="line">        [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>]],</div><div class="line"></div><div class="line">       [[ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>],</div><div class="line">        [<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]]])</div><div class="line"></div><div class="line">In [<span class="number">9</span>]: arr.transpose((<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>))</div><div class="line">Out[<span class="number">9</span>]:</div><div class="line">array([[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</div><div class="line">        [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]],</div><div class="line"></div><div class="line">       [[ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</div><div class="line">        [<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]]])</div><div class="line"></div><div class="line">In [<span class="number">10</span>]: arr.swapaxes(<span class="number">0</span>,<span class="number">1</span>)</div><div class="line">Out[<span class="number">10</span>]:</div><div class="line">array([[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</div><div class="line">        [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]],</div><div class="line"></div><div class="line">       [[ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</div><div class="line">        [<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]]])</div></pre></td></tr></table></figure>
<h4 id="Universal-Functions"><a href="#Universal-Functions" class="headerlink" title="Universal Functions"></a>Universal Functions</h4><p>Ufuncs accept an optional out argument that allows them to operate in-place on arrays: </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">33</span>]: arr</div><div class="line">Out[<span class="number">33</span>]:</div><div class="line">array([<span class="number">-3.503414</span>  ,  <span class="number">1.42652472</span>, <span class="number">-1.73331188</span>, <span class="number">-3.46089728</span>, <span class="number">-0.08580737</span>,</div><div class="line">        <span class="number">3.36266732</span>, <span class="number">-0.80950291</span>])</div><div class="line"></div><div class="line">In [<span class="number">34</span>]: np.sqrt(arr)</div><div class="line">Out[<span class="number">34</span>]:</div><div class="line">array([       nan,  <span class="number">1.1943721</span>,        nan,        nan,        nan,</div><div class="line">        <span class="number">1.8337577</span>,        nan])</div><div class="line"></div><div class="line">In [<span class="number">35</span>]: np.sqrt(arr,arr)</div><div class="line">Out[<span class="number">35</span>]:</div><div class="line">array([       nan,  <span class="number">1.1943721</span>,        nan,        nan,        nan,</div><div class="line">        <span class="number">1.8337577</span>,        nan])</div><div class="line"></div><div class="line">In [<span class="number">36</span>]: arr</div><div class="line">Out[<span class="number">36</span>]:</div><div class="line">array([       nan,  <span class="number">1.1943721</span>,        nan,        nan,        nan,</div><div class="line">        <span class="number">1.8337577</span>,        nan])</div></pre></td></tr></table></figure>
<h4 id="Unary-ufuncs"><a href="#Unary-ufuncs" class="headerlink" title="Unary ufuncs"></a>Unary ufuncs</h4><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>abs, fabs</td>
<td>Compute the absolute value element-wise for integer, floating-point, or complex values. For non-complex values, fabs is faster</td>
</tr>
<tr>
<td>sqr</td>
<td>Compute the square root of each element (equivalent to arr ** 0.5)</td>
</tr>
<tr>
<td>square</td>
<td>Compute the square of each element (equivalent to arr ** 2)</td>
</tr>
<tr>
<td>Exp</td>
<td>Compute the exponent e^x of each element</td>
</tr>
<tr>
<td>log, log10, log2, log1p</td>
<td>Natural logarithm (base e), log base 10, log base 2, and log(1 + x), respectively</td>
</tr>
<tr>
<td>sign</td>
<td>Compute the sign of each element: 1 (positive), 0 (zero), or –1 (negative)</td>
</tr>
<tr>
<td>ceil</td>
<td>Compute the ceiling of each element (i.e., the smallest integer greater than or equal to that number)</td>
</tr>
<tr>
<td>floor</td>
<td>Compute the floor of each element (i.e., the largest integer less than or equal to each element)</td>
</tr>
<tr>
<td>rint</td>
<td>Round elements to the nearest integer, preserving the dtype</td>
</tr>
<tr>
<td>modf</td>
<td>Return fractional and integral parts of array as a separate array</td>
</tr>
<tr>
<td>isnan</td>
<td>Return boolean array indicating whether each value is NaN (Not a Number)</td>
</tr>
<tr>
<td>isfinite, isinf</td>
<td>Return boolean array indicating whether each element is finite (non-inf, non-NaN) or infinite, respectively</td>
</tr>
<tr>
<td>cos, cosh, sin, sinh, tan, tanh</td>
<td>Regular and hyperbolic trigonometric functions</td>
</tr>
<tr>
<td>arccos, arccosh, arcsin, arcsinh, arctan, arctanh</td>
<td>Inverse trigonometric functions</td>
</tr>
<tr>
<td>logical_not</td>
<td>Compute truth value of not x element-wise (equivalent to ~arr)</td>
</tr>
</tbody>
</table>
<h4 id="Binary-universal-functions"><a href="#Binary-universal-functions" class="headerlink" title="Binary universal functions"></a>Binary universal functions</h4><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>add</td>
<td>Add corresponding elements in arrays</td>
</tr>
<tr>
<td>subtract</td>
<td>Subtract elements in second array from first array</td>
</tr>
<tr>
<td>multiply</td>
<td>Multiply array elements</td>
</tr>
<tr>
<td>devide, floor_devide</td>
<td>Divide or floor divide (truncating the remainder)</td>
</tr>
<tr>
<td>power</td>
<td>Raise elements in first array to powers indicated in second array</td>
</tr>
<tr>
<td>maximum, fmax</td>
<td>Element-wise maximum; fmax ignores NaN</td>
</tr>
<tr>
<td>minimum, fmin</td>
<td>Element-wise minimum; fmin ignores NaN</td>
</tr>
<tr>
<td>mod</td>
<td>Element-wise modulus (remainder of division)</td>
</tr>
<tr>
<td>copysign</td>
<td>Copy sign of values in second argument to values in first argument</td>
</tr>
<tr>
<td>greater, greater_equal, less, less_equal, equal, not_equal</td>
<td>Perform element-wise comparison, yielding boolean array (equivalent to infix operators &gt;, &gt;=, &lt;, &lt;=, ==, !=)</td>
</tr>
<tr>
<td>logical_and, logical_or, logical_xor</td>
<td>Compute element-wise truth value of logical operation (equivalent to infix operators &amp;\</td>
<td>,^)</td>
</tr>
</tbody>
</table>
<h4 id="Basic-array-statistical-methods"><a href="#Basic-array-statistical-methods" class="headerlink" title="Basic array statistical methods"></a>Basic array statistical methods</h4><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sum</td>
<td>Sum of all the elements in the array or along an axis; zero-length arrays have sum 0</td>
</tr>
<tr>
<td>mean</td>
<td>Arithmetic mean; zero-length arrays have NaN mean</td>
</tr>
<tr>
<td>std, var</td>
<td>Standard deviation and variance, respectively, with optional degrees of freedom adjustment (default denominator n)</td>
</tr>
<tr>
<td>min, max</td>
<td>Minimum and maximum</td>
</tr>
<tr>
<td>argmin, argmax</td>
<td>Indices of minimum and maximum elements, respectively</td>
</tr>
<tr>
<td>cumsum</td>
<td>Cumulative sum of elements starting from 0</td>
</tr>
<tr>
<td>cumprod</td>
<td>Cumulative product of elements starting from 1</td>
</tr>
</tbody>
</table>
<h4 id="Array-set-operations"><a href="#Array-set-operations" class="headerlink" title="Array set operations"></a>Array set operations</h4><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>unique(x)</td>
<td>Compute the sorted, unique elements in x</td>
</tr>
<tr>
<td>intersect1d(x, y)</td>
<td>Compute the sorted, common elements in x and y</td>
</tr>
<tr>
<td>union1d(x, y)</td>
<td>Compute the sorted union of elements</td>
</tr>
<tr>
<td>in1d(x, y)</td>
<td>Compute a boolean array indicating whether each element of x is contained in y</td>
</tr>
<tr>
<td>setdiff1d(x, y)</td>
<td>Set difference, elements in x that are not in y</td>
</tr>
<tr>
<td>setxor1d(x, y)</td>
<td>Set symmetric differences; elements that are in either of the arrays, but not both</td>
</tr>
</tbody>
</table>
<h4 id="Linear-Algebra"><a href="#Linear-Algebra" class="headerlink" title="Linear Algebra"></a>Linear Algebra</h4><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>diag</td>
<td>Return the diagonal (or off-diagonal) elements of a square matrix as a 1D array, or convert a 1D array into a square matrix with zeros on the off-diagonal</td>
</tr>
<tr>
<td>dot</td>
<td>Matrix multiplication</td>
</tr>
<tr>
<td>trace</td>
<td>Compute the sum of the diagonal elements</td>
</tr>
<tr>
<td>det</td>
<td>Compute the matrix determinant</td>
</tr>
<tr>
<td>eig</td>
<td>Compute the eigenvalues and eigenvectors of a square matrix</td>
</tr>
<tr>
<td>inv</td>
<td>Compute the inverse of a square matrix</td>
</tr>
<tr>
<td>pinv</td>
<td>Compute the Moore-Penrose pseudo-inverse of a matrix</td>
</tr>
<tr>
<td>qr</td>
<td>Compute the QR decomposition</td>
</tr>
<tr>
<td>svd</td>
<td>Compute the singular value decomposition (SVD)</td>
</tr>
<tr>
<td>solve</td>
<td>Solve the linear system Ax = b for x, where A is a square matrix</td>
</tr>
<tr>
<td>lstsq</td>
<td>Compute the least-squares solution to Ax = b</td>
</tr>
</tbody>
</table>
<h4 id="Pseudorandom-Number-Generation"><a href="#Pseudorandom-Number-Generation" class="headerlink" title="Pseudorandom Number Generation"></a>Pseudorandom Number Generation</h4><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>seed</td>
<td>Seed the random number generator</td>
</tr>
<tr>
<td>permutation</td>
<td>Return a random permutation of a sequence, or return a permuted range</td>
</tr>
<tr>
<td>shuffle</td>
<td>Randomly permute a sequence in-place</td>
</tr>
<tr>
<td>rand</td>
<td>Draw samples from a uniform distribution</td>
</tr>
<tr>
<td>randint</td>
<td>Draw random integers from a given low-to-high range</td>
</tr>
<tr>
<td>randn</td>
<td>Draw samples from a normal distribution with mean 0 and standard deviation 1</td>
</tr>
<tr>
<td>binomial</td>
<td>Draw samples from a binomial distribution</td>
</tr>
<tr>
<td>normal</td>
<td>Draw samples from a normal (Gaussian) distribution</td>
</tr>
<tr>
<td>beta</td>
<td>Draw samples from a beta distribution</td>
</tr>
<tr>
<td>chisquare</td>
<td>Draw samples from a chi-square distribution</td>
</tr>
<tr>
<td>gamma</td>
<td>Draw samples from a gamma distribution</td>
</tr>
<tr>
<td>uniform</td>
<td>Draw samples from a uniform [0, 1) distribution</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wu-yuanyi.github.io/2017/09/13/SAS/SAS编程演义8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuanyi Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WYY's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/13/SAS/SAS编程演义8/" itemprop="url">《SAS编程演义》笔记（8章）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-13T16:43:19+07:00">
                2017-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SAS/" itemprop="url" rel="index">
                    <span itemprop="name">SAS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="菱花荇蔓随双桨：百变绘图"><a href="#菱花荇蔓随双桨：百变绘图" class="headerlink" title="菱花荇蔓随双桨：百变绘图"></a>菱花荇蔓随双桨：百变绘图</h2><h3 id="ODS-Graphics-System"><a href="#ODS-Graphics-System" class="headerlink" title="ODS Graphics System"></a>ODS Graphics System</h3><ul>
<li>ODS Graphics System的语法简介统一，易于学习</li>
<li>ODS Graphics System已包含在BASE模块中，不像GRAPH还要单独购买</li>
</ul>
<p>ODS Graphics System的五大部件：</p>
<ul>
<li>ODS Graphics 语句<ul>
<li>通过ON或OFF开关启用ODS Graphics</li>
<li>通过统计过程选项PLOTS选项创建ODS Graphics</li>
<li>通过BRODER、WIDTH、HEIGHT、OUTPUTFMT、IMAGENAME等控制边框、宽、高、输出格式、以及图片名称。</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/*ODS GRAPHICS语句设置图片的宽、高、边界、名字、格式，并要求绘制累积事件*/</div><div class="line">ods graphics on / width=20cm height=18cm noborder imagename=&quot;failureplot&quot; outputfmt=jpg;</div><div class="line">proc lifetest data=sashelp.bmt plots=(s(f));</div><div class="line">    time t*status(0);</div><div class="line">    strata group;</div><div class="line">run;</div></pre></td></tr></table></figure>
<ul>
<li>ODS Graphics设计器：通过图形化交互式界面创建、设计个性化的ODS Graphics，并自动生成GTL<ul>
<li>运行SAS自带的宏程序%sddesign来启动</li>
<li>菜单-&gt;工具-&gt;SAS ODS Graphics设计器启动</li>
</ul>
</li>
<li>ODS Graphics编辑器：通过图形化的交互式界面修改ODS Graphics的元素</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/*在ODS Destination中用sge-on来打开，再生成ODS Graphics时，就会生成可编辑的SGE文件*/</div><div class="line">ods html sge=on;</div><div class="line">ods graphics on / width=20cm height=18cm noborder imagename=&quot;failureplot&quot; outputfmt=jpg;</div><div class="line">proc lifetest data=sashelp.bmt plots=(s(f));</div><div class="line">    time t*status(0);</div><div class="line">    strata group;</div><div class="line">run;</div><div class="line">ods html sge=off;</div></pre></td></tr></table></figure>
<ul>
<li>ODS Graphics 过程：通过简单、简洁的语法创建各式各样的统计图形，包括5个过程：<ul>
<li>SGPLOT：创建多种多样的单个图（单格图）</li>
<li>SGPANEL：创建面板图（多格图）</li>
<li>SGSCATTER：创建矩阵散点图</li>
<li>SGDESIGN：基于SAS ODS Graphics 设计器文件创建图形</li>
<li>SGRENDER：基于图形模版语言（GTL）和SGE文件创建图形</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.class;</div><div class="line">    scatter x=height y=weight;</div><div class="line">    reg x=height y=weight / cli clm;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.class;</div><div class="line">    vbar sex / respose=weight;</div><div class="line">run;</div></pre></td></tr></table></figure>
<ul>
<li><p>SAS GTL：图形模版语言，一种创建复杂的、个性化图形的绘图语言。具体使用时先通过TEMPLATE过程定义，再通过SGRENDER加载渲染。</p>
<ol>
<li>定义，在PROC TEMPLATE过程中用DEFINE STARTGRAPH语句块定义绘图模版。</li>
</ol>
<p><strong>proc template</strong>;</p>
<p>​    define statgraph template-name;</p>
<p>​        begin graph / &lt;options&gt;;</p>
<p>​            &lt;gtl statements to define the graph&gt;</p>
<p>​        endgraph;</p>
<p>​    end;</p>
<p><strong>run</strong>;</p>
<ol>
<li>渲染，用PROC SGRENDER关联绘图数据与绘图模版，渲染生成图形。</li>
</ol>
<p><strong>proc serenader</strong> data=data-set-name</p>
<p>​    template=template-name;</p>
<p><strong>run</strong>;</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">proc template;</div><div class="line">    define statgraph scatterreg;</div><div class="line">        begingraph;</div><div class="line">            layout overlay;</div><div class="line">                scatterplot x=height y=weight;</div><div class="line">                regressionplot x=height y=weight / name=&quot;fitline&quot; legendlabel=&quot;Regression line&quot; clm=&quot;clm&quot; cli=&quot;cli&quot;;</div><div class="line">                modelband &quot;clm&quot; / name=&quot;bandclm&quot; legendlabel=&quot;95% CLM&quot; datatransparency=0.3;</div><div class="line">                modelband &quot;cli&quot; / name=&quot;bandcli&quot; legendlabel=&quot;95% CLI&quot; display=(outline);</div><div class="line">                discreatelegend &quot;fitline&quot; &quot;bandclm&quot; &quot;bandcli&quot;;</div><div class="line">            endlayout;</div><div class="line">        endgraph;</div><div class="line">    end;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgrender data=sashelp.class template=scatterreg;</div><div class="line">run;</div></pre></td></tr></table></figure>
<h3 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h3><ul>
<li>Less is more</li>
<li>点：让每一个点清晰可见。</li>
<li>线：不同组的线条应该用不同颜色或不同样式区分，可依据需要添加趋势线和参考线。</li>
<li>条：一般不给条加边框，不建议条之间重叠，条与条之间间隔比例为1:1.5～1:0.5为宜；建议颜色填充而非样式，可用颜色强度代表重要程度；如果希望显示排名顺序或分类标签太长、分类太多，建议用横向条图。</li>
<li>刻度线：刻度尺过于离散，建议用Log转换，一般情况下，纵坐标刻度要从零开始</li>
<li>图例：确实需要说明时才增加图例；为不使图例喧宾夺主，一般不加边框；图例一般置于图右侧，若图较宽、图例文字较长时，图例横向置于图内的上／下方。</li>
<li>其他：不建议用饼图、不建议用3D图</li>
</ul>
<h3 id="条图系列"><a href="#条图系列" class="headerlink" title="条图系列"></a>条图系列</h3><h4 id="单式条图"><a href="#单式条图" class="headerlink" title="单式条图"></a>单式条图</h4><p>要分析的变量就一个分类变量时，此时适用单式条图或百分比条图。</p>
<ul>
<li>HBAR：横向条图</li>
</ul>
<ul>
<li>VBAR：纵向条图</li>
<li>CATEGORYORDER=：排序方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    hbar DriveTrain / categoryorder=respdesc; /*横向 响应值降序*/</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vbar DriveTrain / categoryorder=respssc; /*纵向 响应值升序*/</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/1.png" alt="横向条图"></p>
<h4 id="频数图"><a href="#频数图" class="headerlink" title="频数图"></a>频数图</h4><p>使PROC FREQ里TABLE语句的选项PLOTS=FREQPLOTS，此选项会自动调用ODS Graphics System绘制频数图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc freq data=sashelp.cars;</div><div class="line">    table DriveTrain / plots=freqplots;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/../images/SAS/2.png" alt="频数图"></p>
<h4 id="带误差限的单式条图"><a href="#带误差限的单式条图" class="headerlink" title="带误差限的单式条图"></a>带误差限的单式条图</h4><ul>
<li>RESPONSE：指定连续变量</li>
<li>STAT=：指定统计指标</li>
<li>LIMITSTAT=：stddev, stderr, clm 指定限制线统计量</li>
<li>LIMITS=：upper, lower, both 指定限制线展示形式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vbar type /response=msrp stat=mean limitstat=stddev limits=upper;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/3.png" alt="带误差限的单式条图条图"></p>
<h4 id="单式百分比条图"><a href="#单式百分比条图" class="headerlink" title="单式百分比条图"></a>单式百分比条图</h4><p>单式百分比条图在绘制时需要先增加辅助分组变量，而后通过PROC SGPLOT的HBAR或VBAR实现。</p>
<ul>
<li>GROUP=：指定分组变量</li>
<li>GROUPDISPLAY=：指定为堆叠方式显示</li>
<li>STAT=PERCENT：指定统计指标为百分比</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">data cars;</div><div class="line">    set sashelp.cars;</div><div class="line">    Drive_Train=&quot;Drive Type&quot;; /**/</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=cars noborder;</div><div class="line">    hbar Drive_Train / group=DriveTrain groupdisplay=stack stat=percent categoryorder=respdesc;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/4.png" alt="单式百分比条图"></p>
<h4 id="簇拥式复式条图"><a href="#簇拥式复式条图" class="headerlink" title="簇拥式复式条图"></a>簇拥式复式条图</h4><p>单式百分比条图就是复式条图的一种特例。</p>
<ul>
<li>GROUP=：指定分组变量</li>
<li>GROUPDISPLAY=：控制分组显示方式，簇拥式（cluster），堆叠式（stack）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vbar origin / group=DriveTrain groupdisplay=cluster;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/5.png" alt="簇拥式复式条图"></p>
<h4 id="簇拥式复式误差限条图"><a href="#簇拥式复式误差限条图" class="headerlink" title="簇拥式复式误差限条图"></a>簇拥式复式误差限条图</h4><ul>
<li>RESPONSE：指定连续变量</li>
<li>STAT=：指定统计指标</li>
<li>LIMITSTAT=：stddev, stderr, clm 指定限制线统计量</li>
<li>LIMITS=：upper, lower, both 指定限制线展示形式</li>
<li>GROUP=：指定分组变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vbar origin / response=msrp stat=mean group=type groupdisplay=cluster limitstat=stddev limits=lower;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/6.png" alt="簇拥式复式误差限条图"></p>
<h4 id="复式百分比条图"><a href="#复式百分比条图" class="headerlink" title="复式百分比条图"></a>复式百分比条图</h4><ul>
<li>PCTLEVEL=GROUP：控制百分比为分组的百分比</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars pctlevel=group;</div><div class="line">    vbar origin / group=DriveTrain groupdisplay=cluster stat=percent; /*簇拥式*/</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.cars pctlevel=group;</div><div class="line">    vbar origin / group=DriveTrain groupdisplay=stack stat=percent; /*堆叠式*/</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/7.png" alt="簇拥式复式误差限条图"></p>
<h4 id="马赛克图"><a href="#马赛克图" class="headerlink" title="马赛克图"></a>马赛克图</h4><p>使PROC FREQ里TABLE语句的选项PLOTS=MAOSAICPLOT，此选项会自动调用ODS Graphics System绘马赛克图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc freq data=sashelp.cars;</div><div class="line">    table origin*DriveTrain / plots=mosaicplot;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/8.png" alt="马赛克图"></p>
<h4 id="镜面式复式条图"><a href="#镜面式复式条图" class="headerlink" title="镜面式复式条图"></a>镜面式复式条图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">data pop; /*创建测试数据集*/</div><div class="line">    length AgeGroup $12;</div><div class="line">    do AgeGroup=&apos;Pre Teen&apos;, &apos;Teen&apos;, &apos;Young Adult&apos;, &apos;Adult&apos;, &apos;Senior&apos;;</div><div class="line">        Male=round(500*(1+ranuni(2)));</div><div class="line">        Female=round(400*(1+ranuni(2)));</div><div class="line">        output;</div><div class="line">    end;</div><div class="line">run;</div><div class="line"></div><div class="line">data butterfly; /*变换镜面数据*/</div><div class="line">    set pop;</div><div class="line">    Male=-male;</div><div class="line">    zero=0;</div><div class="line">run;</div><div class="line"></div><div class="line">proc format; /**/</div><div class="line">    picture positive low-&lt;0=&apos;0000&apos; 0&lt;-high=&apos;0000&apos;;</div><div class="line">    /*0-high包含0  0&lt;-high不包含0*/</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=ButterFly; /*横向镜面*/</div><div class="line">    format male female positive.;</div><div class="line">    hbarparm category=agegroup response=male;</div><div class="line">    hbarparm category=agegroup response=female;</div><div class="line">    xaxis display=(noline nolabel) values=(-1000 to 1000 by 200);</div><div class="line">    yaxis display=(noline nolabel);</div><div class="line">    keylegend / position=right across=1 noopaque;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=ButterFly; /*纵向镜面*/</div><div class="line">    format male female positive.;</div><div class="line">    vbarparm category=agegroup response=male;</div><div class="line">    vbarparm category=agegroup response=female;</div><div class="line">    xaxis display=(noline nolabel);</div><div class="line">    yaxis display=(noline nolabel) values=(-1000 to 1000 by 200);</div><div class="line">    keylegend / position=right across=1 noopaque;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/9.png" alt="横向镜面复式条图"></p>
<h4 id="面板条图"><a href="#面板条图" class="headerlink" title="面板条图"></a>面板条图</h4><p>通过PROC SGPANEL实现面板条图，用PANELBY语句指定面板分量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">proc sgpanel data=sashelp.cars pctlevel=group; /**/</div><div class="line">    panelby type;</div><div class="line">    vbar origin / group=DriveTrain groupdisplay=cluster stat=percent;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgpanel data=sashelp.cars pctlevel=group; /**/</div><div class="line">    panelby type;</div><div class="line">    vbar origin / group=DriveTrain groupdisplay=stack stat=percent categoryorder=respdesc;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/10.png" alt="簇拥式面板条图"></p>
<h3 id="直方图系列"><a href="#直方图系列" class="headerlink" title="直方图系列"></a>直方图系列</h3><h4 id="简单直方图"><a href="#简单直方图" class="headerlink" title="简单直方图"></a>简单直方图</h4><ul>
<li>NBINS：直方的数量</li>
<li>BINWIDTH：直方的宽度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars; /*简单直方图（sgplot）*/</div><div class="line">    histogram msrp / nbins =20;</div><div class="line">run;</div><div class="line"></div><div class="line">proc univariate data=sashelp.cars; /*简单直方图（univariate）*/</div><div class="line">    histogram msrp;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/11.png" alt="简单直方图"></p>
<h4 id="重叠直方图"><a href="#重叠直方图" class="headerlink" title="重叠直方图"></a>重叠直方图</h4><ul>
<li>可以用GROUP设置分组变量，也可以用多个HISTOGRAM语句叠加</li>
<li>使用TRANSPARENCY设置透明度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars; /*通过group设置分组变量*/</div><div class="line">    histogram msrp / nbins=20 group=type;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.cars; /*多个histogram叠加*/</div><div class="line">    histogram mpg_city / binstart=0 binwidth=2 transparency=0.5;</div><div class="line">    histogram mpg_highway / binstart=0 binwidth=2 transparency=0.5;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/12.png" alt="重叠直方图"></p>
<h4 id="镜面直方图"><a href="#镜面直方图" class="headerlink" title="镜面直方图"></a>镜面直方图</h4><p>无法通过 SGPLOT直接实现，需要借助GTL语言。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">/*定义模版*/</div><div class="line">proc template;</div><div class="line">    define statgraph MirrorHistogramVert;</div><div class="line">        dynamic _binwidth;</div><div class="line">            begingraph; </div><div class="line">            entrytitle &quot;Mileage distribution&quot;;</div><div class="line">            /*定义布局*/</div><div class="line">            layout lattice / columndatarange=union rowgutter=0;</div><div class="line">                /*定义横轴*/</div><div class="line">                columnases;</div><div class="line">                columnaxis / display=(tickvalues) griddisplay=on linearopts=(tickvaluesequence=(start=0 end=60 increment=10) tickvaluepriority=true);</div><div class="line">                endcolumnases;</div><div class="line">                /*上部分直方图*/</div><div class="line">                layout overlay / walldisplay=none xaxisopts=(griddisplay=on) yaxisopts=(griddisplay=on display=(tickvalues label) linearopts=(tickvaluesequence=(start=5 end=25 increment=5) tickvaluepriority=true));</div><div class="line">                histogram mpg_city/binstart=0 binwidth=_binwidth binaxis=false fillattrs=graphdata1 datatransparency=0.3;</div><div class="line">                entry halign=right &quot;City Mileage&quot; / valign=top;</div><div class="line">                endlayout;</div><div class="line">                /*下部分直方图*/</div><div class="line">                layout overlay / walldisplay=none xaxisopts=(griddisplay=on) yaxisopts=(reverse=true griddisplay=on display=(tickvalues label) linearopts=(tickvaluesequence=(start=5 end=25 increment=5) tickvaluepriority=true));</div><div class="line">                histogram mpg_highway/binstart=0 binwidth=_binwidth binaxis=false fillattrs=graphdata2 datatransparency=0.3;</div><div class="line">                entry halign=right &quot;City Mileage&quot; / valign=top;</div><div class="line">                endlayout;</div><div class="line">            endlayout;</div><div class="line">        endgraph;</div><div class="line">    end;</div><div class="line">run;</div><div class="line"></div><div class="line">/*渲染模版*/</div><div class="line">ods graphics / NOBORDER reset width=5in height=3in imagename=&quot;MirrorHistogramVert&quot;;</div><div class="line">proc sgrender data=sashelp.cars template=MirrorHistogramVert;</div><div class="line">    dynamic _binwidth=2;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/13.png" alt="镜面直方图"></p>
<h4 id="面板直方图"><a href="#面板直方图" class="headerlink" title="面板直方图"></a>面板直方图</h4><p>通过PROC SGPANEL和HISTOGRAM语句来实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">proc sgpanel data=sashelp.cars;</div><div class="line">    panelby origin / layout=columnlattice;</div><div class="line">    histogram mpg_city / binstart=0 binwidth=2 transparency=0.5;</div><div class="line">    histogram mpg_highway / binstart=0 binwidth=2 transparency=0.5;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/14.png" alt="面板直方图"></p>
<h3 id="箱型图系列"><a href="#箱型图系列" class="headerlink" title="箱型图系列"></a>箱型图系列</h3><p>箱线图提供了更为明确的统计量信息，如均数，P25，P50以及P75。箱线图可以通过PROC SGPLOT的VBOX或HBOX实现。</p>
<h4 id="简单箱型图"><a href="#简单箱型图" class="headerlink" title="简单箱型图"></a>简单箱型图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vbox msrp; /*纵向*/</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    hbox msrp; /*横向*/</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/15.png" alt="简单箱型图"></p>
<h4 id="分组箱型图"><a href="#分组箱型图" class="headerlink" title="分组箱型图"></a>分组箱型图</h4><p>分组箱形图的绘制只需在VBOX或HBOX语句中增加用GROUP分组变量即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vbox msrp / group=type;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/16.png" alt="分组箱型图"></p>
<h4 id="面板箱型图"><a href="#面板箱型图" class="headerlink" title="面板箱型图"></a>面板箱型图</h4><p>面板箱型图可通过PROC SGPANEL过程实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">proc sgpanel data=sashelp.cars;</div><div class="line">    panelby origin / layout=columnlattice;</div><div class="line">    vbox msrp / group=type;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/17.png" alt="面板箱型图"></p>
<h3 id="散点图系列"><a href="#散点图系列" class="headerlink" title="散点图系列"></a>散点图系列</h3><h4 id="X-Y散点图"><a href="#X-Y散点图" class="headerlink" title="X-Y散点图"></a>X-Y散点图</h4><p>X-Y散点图可通过PROC SGPLOT的SCATTER语句实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    scatter x=horsepower y=mpg_highway;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/18.png" alt="X-Y散点图"></p>
<h4 id="X-Y散点回归图"><a href="#X-Y散点回归图" class="headerlink" title="X-Y散点回归图"></a>X-Y散点回归图</h4><ul>
<li>使用REG语句增加回归线</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    scatter x=horsepower y=mpg_highway;</div><div class="line">    reg x=horsepower y=mpg_highway;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/19.png" alt="X-Y散点回归图"></p>
<h4 id="分组散点图"><a href="#分组散点图" class="headerlink" title="分组散点图"></a>分组散点图</h4><ul>
<li>使用GROUP选项增绘制分组散点图</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    scatter x=horsepower y=mpg_highway / group=type;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/20.png" alt="分组散点图"></p>
<h4 id="面板散点图"><a href="#面板散点图" class="headerlink" title="面板散点图"></a>面板散点图</h4><p>在PROC SGPANEL中用PANELBY语句指定分面变量，而后用SCATTER语句绘制散点图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">proc sgpanel data=sashelp.cars;</div><div class="line">    panelby origin / layout=columnlattice;</div><div class="line">    scatter x=horsepower y=mpg_highway / group=type;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/21.png" alt="面板散点图"></p>
<h4 id="泡泡图"><a href="#泡泡图" class="headerlink" title="泡泡图"></a>泡泡图</h4><p>增加一个变量控制散点图中点的大小，通过PROC SGPLOT中的BUBBLE实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    bubble x=horsepower y=mpg_highway size=cylinders;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/22.png" alt="泡泡图"></p>
<h4 id="矩阵散点图"><a href="#矩阵散点图" class="headerlink" title="矩阵散点图"></a>矩阵散点图</h4><p>探查多个变量之间两两的关系。通过PROC SGSCATTER实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgscatter data=sashelp.cars;</div><div class="line">    matrix mpg_highway horsepower enginesize / diagonal=(histogram noraml);</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/23.png" alt="矩阵散点图"></p>
<h3 id="折线图系列"><a href="#折线图系列" class="headerlink" title="折线图系列"></a>折线图系列</h3><h4 id="简单折线图"><a href="#简单折线图" class="headerlink" title="简单折线图"></a>简单折线图</h4><p>若X与Y一一对应，可以用SERIES语句绘制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.stocks (where=(date &gt;= &quot;01jan2002&quot;d and stock=&quot;IBM&quot;));</div><div class="line">    series x=date y=close;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/24.png" alt="简单折线图（X与Y一一对应）"></p>
<p>若X与Y不是一一对应，可以用VLINE或HLINE语句绘制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vline cylinders / response=msrp stat=mean markers;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/../images/SAS/25.png" alt="简单折线图（X与Y不是一一对应）"></p>
<h4 id="误差折线图"><a href="#误差折线图" class="headerlink" title="误差折线图"></a>误差折线图</h4><p>使用LIMITS和LIMITSTAT。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vline cylinders / response=msrp stat=mean limits=both limitstat=stddev markers;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/26.png" alt="误差折线图"></p>
<h4 id="分组误差折线图"><a href="#分组误差折线图" class="headerlink" title="分组误差折线图"></a>分组误差折线图</h4><p>用GROUP选项指定分组变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    vline cylinders / response=msrp stat=mean group=type limits=both limitstat=stddev markers;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/27.png" alt="分组误差折线图"></p>
<h4 id="面板误差折线图"><a href="#面板误差折线图" class="headerlink" title="面板误差折线图"></a>面板误差折线图</h4><p>PROC SGPANEL过程中使用PANELBY语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">proc sgpanel data=sashelp.cars;</div><div class="line">    panelby origin / layout=columnlattice;</div><div class="line">    vline cylinders / response=msrp stat=mean group=type limit=both limitstat=stddev markers;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/28.png" alt="面板误差折线图"></p>
<h3 id="面积图系列"><a href="#面积图系列" class="headerlink" title="面积图系列"></a>面积图系列</h3><h4 id="面积图"><a href="#面积图" class="headerlink" title="面积图"></a>面积图</h4><p>通过PROC SGPLOT的BAND语句实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/*重叠面积图*/</div><div class="line">proc sgplot data=sashelp.stocks(where=(date&gt;=&quot;01jan2002&quot;d and stock=&quot;IBM&quot;));</div><div class="line">    band x=date lower=0 upper=high / legendlabel=&quot;High&quot;;</div><div class="line">    band x=date lower=0 upper=low / legendlabel=&quot;Low&quot;;</div><div class="line">run;</div><div class="line"></div><div class="line">/*非重叠面积图*/</div><div class="line">proc sgplot data=sashelp.stocks(where=(date&gt;=&quot;01jan2002&quot;d and stock=&quot;IBM&quot;));</div><div class="line">    band x=date lower=0 upper=high / legendlabel=&quot;High&quot;;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/29.png" alt="面积图"></p>
<h4 id="带状图"><a href="#带状图" class="headerlink" title="带状图"></a>带状图</h4><p>通过PROC SGPLOT的BAND语句实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.stocks(where=(date&gt;=&quot;01jan2002&quot;d and stock=&quot;IBM&quot;));</div><div class="line">    band x=date lower=low upper=high / legendlabel=&quot;High&quot;;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/30.png" alt="带状图"></p>
<h3 id="拟合图系列"><a href="#拟合图系列" class="headerlink" title="拟合图系列"></a>拟合图系列</h3><h4 id="密度曲线"><a href="#密度曲线" class="headerlink" title="密度曲线"></a>密度曲线</h4><p>可以用PROC UNIVARIATE过程中的HISTOGRAM语句，也可以用PROCSGPLOT的DENSITY语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">proc univariate data=sashelp.cars; /*统计过程*/</div><div class="line">    histogram msrp / normal;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.cars; /*绘图过程*/</div><div class="line">    histogram msrp / nbins=20;</div><div class="line">    density msrp;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/31.png" alt="密度曲线"></p>
<h4 id="回归线"><a href="#回归线" class="headerlink" title="回归线"></a>回归线</h4><p>可以用PROC REG过程中的PLOTS选项，也可以用PROC SGPLOT的REG语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">proc reg data=sashelp.cars plots(only)=fitplot; /*统计过程*/</div><div class="line">    model mpg_highway=horsepower;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.cars; /*绘图过程*/</div><div class="line">    scatter x=horsepower y=mpg_highway;</div><div class="line">    reg x=horsepower y=mpg_highway / cli clm;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/32.png" alt="回归线"></p>
<h4 id="椭圆曲线"><a href="#椭圆曲线" class="headerlink" title="椭圆曲线"></a>椭圆曲线</h4><p>通过PROC SGPLOT的ELLIPSE语句实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    scatter x=horsepower y=mpg_highway;</div><div class="line">    ellipse x=horsepower y=mpg_highway;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/../images/SAS/33.png" alt="椭圆曲线"></p>
<h4 id="ROC曲线"><a href="#ROC曲线" class="headerlink" title="ROC曲线"></a>ROC曲线</h4><p>通过PROC LOGISTIC回归的PLOTS选项实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">proc logistic data=sashelp.heart plots=roc;</div><div class="line">    class sex Chol_Status BP_Status Weight_Status Smoking_Status;</div><div class="line">    model Status(event=&quot;Dead&quot;)=AgeAtStart sex Chol_Status BP_Status Weight_Status Smoking_Status;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/34.png" alt="ROC曲线"></p>
<h4 id="Kaplan-Meier曲线"><a href="#Kaplan-Meier曲线" class="headerlink" title="Kaplan-Meier曲线"></a>Kaplan-Meier曲线</h4><p>通过PROC LIFETEST的PLOTS选项实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/*生存曲线*/</div><div class="line">proc lifetest data=sashelp.bmt plots=s;</div><div class="line">    time t*status(0);</div><div class="line">    strata group;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/../images/SAS/35.png" alt="生存曲线"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/*累积事件*/</div><div class="line">proc lifetest data=sashelp.bmt plots=s(failure);</div><div class="line">    time t*status(0);</div><div class="line">    strata group;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/36.png" alt="累积事件"></p>
<h4 id="LOESS曲线"><a href="#LOESS曲线" class="headerlink" title="LOESS曲线"></a>LOESS曲线</h4><p>局部加权回归散点发（Locally Weighted Scattered Plot Smoothing, LOESS）</p>
<ul>
<li>PROC LOESS过程的PLOTS语句，AICC选项指定平滑程度</li>
<li>PROC SGPLOT过程的LOESS语句，SMOOTH选项指定平滑程度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">proc loess data=sashelp.cars plots(only)=(FItPlot);</div><div class="line">    model mpg_highway=horsepower / select=AICC alpha=0.05 all;</div><div class="line">run;</div><div class="line"></div><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    loess x=horsepower y=mpg_highway;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/../images/SAS/37.png" alt="LOESS曲线"></p>
<h4 id="Spline曲线"><a href="#Spline曲线" class="headerlink" title="Spline曲线"></a>Spline曲线</h4><p>SAS中最容易实现的样条函数是Penalized B-Spline Curve，可通过PROC SGPLOT里的PBSPLINE语句绘制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=sashelp.cars;</div><div class="line">    pbspline x=horsepower y=mpg_highway;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/38.png" alt="LOESS曲线"></p>
<h3 id="森林图系列"><a href="#森林图系列" class="headerlink" title="森林图系列"></a>森林图系列</h3><p>通过PROC SGPLOT的SCATTER语句及其XERRORUPPER和XERRORLOWER选项绘制，或通过highlow语句绘制。</p>
<h4 id="简单森林图"><a href="#简单森林图" class="headerlink" title="简单森林图"></a>简单森林图</h4><ul>
<li>用HIGHLOW语句绘制效应值机器95%CI</li>
<li>文字部分借助9.4的新语句YAXISTABLE直接插入文字变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=fr noautolegend nocycleattrs nowall noborder;</div><div class="line">/*文字*/</div><div class="line">yaxistable Study CABG PCI_DES RR / position=left labelattrs=(size=7);</div><div class="line">/*图*/</div><div class="line">scatter y=study x=rr_m / markerattrs=graphadata2(symbol=squarefilled);</div><div class="line">scatter y=study x=rr_2 / markerattrs=graphadata2(symbol=diamondfilled size=10);</div><div class="line">highlow y=study low=rr_1 high=rr_u / type=line;</div><div class="line">/*坐标轴*/</div><div class="line">xaxis values=(0 to 3 by 1) display=(nolabel) valueattrs=(size=7);</div><div class="line">yaxis display=none fitpolicy=none reverse colorbands=even valueattrs=(size=7) colorbandattrs=Graphdatadefault(transparency=0.8);</div><div class="line">/*参考线*/</div><div class="line">refline 1 /axis=x noclip;</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/39.png" alt="简单森林图"></p>
<h4 id="亚组分析森林图"><a href="#亚组分析森林图" class="headerlink" title="亚组分析森林图"></a>亚组分析森林图</h4><p>SAS 9.40M3的STYLEATTRS语句新增了AXISEXTENT选项，YAXISTABLE语句增加了INDENTWEIGHT和PAD选项，可以单凭SGPLOT完美实现亚组分析森林图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">proc sgplot data=forest_subgroup_2 nowall noborder nocycleattrs dattrmap=attrmap noautolegend;</div><div class="line">    styleattrs axisextent=data;</div><div class="line">    /*左边的文字*/</div><div class="line">    yaxistable subgroup / location=inside position=left textgroup=id labelattrs=(size=7) textgroupid=text indentweight=indentWt;</div><div class="line">    yaxistable countpct / location=inside position=left labelattrs=(size=7) valueattrs=(size=7);</div><div class="line">    yaxistable PCIGroup group pvalue / location=inside position=right pad=(right=15px) labelattrs=(size=7) valueattrs=(size=7);</div><div class="line">    /*绘制95%CIBAR*/</div><div class="line">    highlow y=obsid low=low high=high; </div><div class="line">    /*绘制Bar的中点*/</div><div class="line">    scatter y=obsid x=mean / markerattrs=(symbol=squarefilled);</div><div class="line">    /*二次绘制Bar中点，关联x2axis*/</div><div class="line">    scatter y=obsid x=mean / markerattrs=(size=0) x2axis;</div><div class="line">    /*底部文字*/</div><div class="line">    text x=xl y=obsid text=text / position=bottom contributeoffsets=none strip;</div><div class="line">    format text $txt.;</div><div class="line">    /*坐标轴*/</div><div class="line">    yaxis reverse display=none colorbands=odd colorbandsattrs=(transparency=1) offsetmin=0.0;</div><div class="line">    xaxis display=(nolabel) values=(0.0 0.5 1.0 1.5 2.0 2.5);</div><div class="line">    x2axis label=&apos;Hazard Ratio&apos; display=(noline noticks novalues) labelattrs=(size=8);</div><div class="line">    /*参考线*/</div><div class="line">    refline 1 / axis=x;</div><div class="line">    refline ref / lineattrs=(thickness=13 color=cxf0f0f7);</div><div class="line">run;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/40.png" alt="亚组分析森林图"></p>
<h3 id="地图系列"><a href="#地图系列" class="headerlink" title="地图系列"></a>地图系列</h3><h4 id="纯地图"><a href="#纯地图" class="headerlink" title="纯地图"></a>纯地图</h4><ul>
<li>MAP：指定地图数据集</li>
<li>DATA：指定反应数据集，即使不在地图上绘制反应变量，仍需指定反应数据集（反应数据集可以和地图数据集是一个数据集）</li>
<li>添加各州名称标注：用US<em>attr</em>这个属性数据集，并利用SAS自带的宏给地图增加标签说明文字，生成标注数据集，然后绘制地图时用ANNO选项指定标注数据集。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">%annomac</div><div class="line">%maplabel(mapsgfk.us, mapsgfk.us_states_attr(keep-id idname), anno_label,idname, id)</div><div class="line"></div><div class="line">proc gmap map=maps.us data=maps.us;</div><div class="line">    id state;</div><div class="line">    choro state / nolegend anno=anno_label;</div><div class="line">run;</div><div class="line">quit;</div><div class="line"></div><div class="line">proc gmap map=maps.us data=maps.us;</div><div class="line">    id state;</div><div class="line">    choro state / nolegend;</div><div class="line">run;</div><div class="line">quit;</div><div class="line"></div><div class="line">proc gmap map=mapsgfk.us data=mapsgfk.us;</div><div class="line">    id id;</div><div class="line">    choro id / nolegend;</div><div class="line">run;</div><div class="line">quit;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/41.png" alt="纯地图"></p>
<h4 id="统计地图"><a href="#统计地图" class="headerlink" title="统计地图"></a>统计地图</h4><p>BLOCK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">data sample;</div><div class="line">    input st $  pop2010 @@;</div><div class="line">    state=stfips(st);</div><div class="line">    datalines;</div><div class="line">    AL 4779 Ak 710 AZ 6392 AR 2815 CA 37253 CO 5029 CT 3574 DE 897 DC 601 FL 18801</div><div class="line">    GA 9687 HI 1360 ID 1567 IL 12830 IN 6483 IA 3046 KS 2853 KY 43339 LA 4533</div><div class="line">    ME 1328 MD 5773 MA 6547 MI 9883 MN 5303 MS 2967 MO 5988 MT 989 NE 1826 NV 2700</div><div class="line">    NH 1316 NJ 8791 NM 2059 NY 19378 NC 9535 ND 672 OH 11536 OK 3751 OR 3831 </div><div class="line">    PA 12702 RI 1052 SC 4625 SD 814 TN 6346 TX 25145 UT 2763 VT 6257 VA 8001 </div><div class="line">    WA 6724 WV 1852 WI 5686 WY 563 PR 3725</div><div class="line">    ;</div><div class="line">run;</div><div class="line"></div><div class="line">proc gmap map=maps.us data=sample;</div><div class="line">    id state;</div><div class="line">    block pop2010 / level=6;</div><div class="line">    format est2015 pop2010 comma12.;</div><div class="line">run;</div><div class="line">quit;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/42.png" alt="统计地图"></p>
<h4 id="热力地图"><a href="#热力地图" class="headerlink" title="热力地图"></a>热力地图</h4><p>CHORO</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">proc gmap map=maps.us data=sample;</div><div class="line">    id state;</div><div class="line">    choro pop2010 / level=6;</div><div class="line">    format est2015 pop2010 comma12.;</div><div class="line">run;</div><div class="line">quit;</div></pre></td></tr></table></figure>
<p><img src="/2017/09/13/SAS/SAS编程演义8/43.png" alt="热力地图"></p>
<h3 id="PROC-SGPLOT总结"><a href="#PROC-SGPLOT总结" class="headerlink" title="PROC SGPLOT总结"></a>PROC SGPLOT总结</h3><p><strong>PROC SGPLOT</strong> &lt;*option(s)&gt;;</p>
<p>​    <strong>STYLEATTRS </strong> &lt;/*option(s)&gt;;</p>
<p>​    <strong>PLOT STATEMENT</strong> &lt;/*option(s)&gt;;</p>
<p>​    <strong>XAXIS</strong> &lt;*option(s)&gt;;</p>
<p>​    <strong>X2AXIS</strong> &lt;*option(s)&gt;;</p>
<p>​    <strong>YAXIS</strong> &lt;*option(s)&gt;;</p>
<p>​    <strong>Y2AXIS</strong> &lt;*option(s)&gt;;</p>
<p>​    <strong>KEYLEGEND</strong> &lt;<em>“name-1” … “name-n”</em>&gt; &lt;/*option(s)&gt;;</p>
<p>​    <strong>GRADLEGEND</strong> &lt;<em>“name”</em>&gt; &lt;/*option(s)&gt;;</p>
<p><strong>RUN</strong>;</p>
<p><a href="http://support.sas.com/resources/papers/proceedings12/259-2012.pdf" target="_blank" rel="external">SGPLOT and SGPANEL plot statements and selected options</a></p>
<table>
<thead>
<tr>
<th></th>
<th>syntax</th>
<th>selected options</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>SCATTER</td>
<td>scatter x=var y=var / options;</td>
<td>datalabel=var</td>
<td>Displays a label for each data point</td>
</tr>
<tr>
<td>SERIES</td>
<td>series x=var y=var / options;</td>
<td>break</td>
<td>Creates a break in the line for each missing value</td>
</tr>
<tr>
<td></td>
<td></td>
<td>curvelabel</td>
<td>Labels the series curve using the Y variable label</td>
</tr>
<tr>
<td>STEP</td>
<td>step x=var y=var / options;</td>
<td>break</td>
<td>Creates a break in the line for each missing value</td>
</tr>
<tr>
<td></td>
<td></td>
<td>curvelabel</td>
<td>Labels the series curve using the Y variable label</td>
</tr>
<tr>
<td>NEEDLE</td>
<td>needle x=var y=var / options;</td>
<td>baseline=val</td>
<td>specifies a numeric value on the Y axis for the baseline</td>
</tr>
<tr>
<td>VECTOR</td>
<td>vector x=var y=var / options;</td>
<td>xorigin=val</td>
<td>specifies Xcoordinate for origin either numeric value or numeric variable</td>
</tr>
<tr>
<td></td>
<td></td>
<td>yorigin=val</td>
<td>specifies Ycoordinate for origin either numeric value or numeric variable</td>
</tr>
<tr>
<td>BUBBLE</td>
<td>bubble x=var y=var size=var / options;</td>
<td>fill</td>
<td>specifies fill is visible</td>
</tr>
<tr>
<td></td>
<td></td>
<td>nofill</td>
<td>specifies fill is not visible</td>
</tr>
<tr>
<td></td>
<td></td>
<td>outline</td>
<td>specifies outline is visible</td>
</tr>
<tr>
<td></td>
<td></td>
<td>nooutline</td>
<td>specifies outline is not visible</td>
</tr>
<tr>
<td>BAND</td>
<td>band x=var upper=var lower=var / options;</td>
<td>fill</td>
<td>specifies fill is visible</td>
</tr>
<tr>
<td></td>
<td></td>
<td>nofill</td>
<td>specifies fill is not visible</td>
</tr>
<tr>
<td></td>
<td></td>
<td>outline</td>
<td>specifies outline is visible</td>
</tr>
<tr>
<td></td>
<td></td>
<td>nooutline</td>
<td>specifies outline is not visible</td>
</tr>
<tr>
<td>HIGHLOW</td>
<td>highlow x=var high=var lo=var / options;</td>
<td>highcap=val</td>
<td>specifies type of cap to use at end of bar or line</td>
</tr>
<tr>
<td></td>
<td></td>
<td>lowcap=val</td>
<td>specifies type of cap to use at end of bar or line</td>
</tr>
<tr>
<td></td>
<td></td>
<td>type=val</td>
<td>specifie how to draw glot with a: BAR or LINE(default)</td>
</tr>
</tbody>
</table>
<h3 id="图片属性控制"><a href="#图片属性控制" class="headerlink" title="图片属性控制"></a>图片属性控制</h3><ul>
<li>GPATH：存储位置</li>
<li>DPI：分辨率</li>
<li>WIDTH：宽</li>
<li>HEIGHT：高</li>
<li>OUTPUTFMT：格式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ods html style=ggStyle gpath=&apos;d:\StatsGraph&apos; dpi=600;</div><div class="line">ods graphics / width=14cm height=10cm outputfmt=jpg;</div></pre></td></tr></table></figure>
<p>输出终端LISTING既支持EPS矢量图，也支持TIF位图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ods listing gpath=&quot;D:\myGraph&quot; dpi=300;</div><div class="line"></div><div class="line">ods graphics on / imagename=&quot;eps&quot; outputfmt=EPS; /*矢量图*/</div><div class="line">绘图语句;</div><div class="line"></div><div class="line">ods graphics on / imagename=&quot;tif&quot; outputfmt=TIF; /*位图*/</div><div class="line">绘图语句;</div><div class="line"></div><div class="line">ods listing close;</div></pre></td></tr></table></figure>
<p>PRINTER终端的优势是可以在一个语句里同时设置格式和分辨率，但劣势是绘制的图片仅仅是其输出的一部分区域。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ods printer printer=Postscript FILE=&quot;D:\eps.eps&quot; dpi=300; /*矢量图*/</div><div class="line">绘图语句</div><div class="line">ods printer close;</div><div class="line"></div><div class="line">ods printer printer=tiff FILE=&quot;D:\tif.tif&quot; dpi=300; /*位图*/</div><div class="line">绘图语句</div><div class="line">ods printer close;</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <p class="site-author-name" itemprop="name">Yuanyi Wu</p>
            <p class="site-description motion-element" itemprop="description">朝闻道 夕死可矣</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wu-yuanyi" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/yuanyi.wu.39" target="_blank" title="FB Page">
                  
                    <i class="fa fa-fw fa-facebook"></i>FB Page</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yuanyi Wu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">Theme &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
